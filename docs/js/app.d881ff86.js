(function(){"use strict";var e={5363:function(e,t,o){var r=o(9746),n=o(5976);function a(e,t,o,r,a,l){const u=(0,n.g2)("RouterView");return(0,n.uX)(),(0,n.Wv)(u)}var l={name:"App"},u=o(1169);const i=(0,u.A)(l,[["render",a]]);var s=i,c=o(9053),d=o(160);const m={class:"login"},v={key:0,class:"error"};function f(e,t,o,a,l,u){return(0,n.uX)(),(0,n.CE)("div",m,[t[8]||(t[8]=(0,n.Lk)("h1",null,"Войти в Matrix",-1)),(0,n.Lk)("form",{onSubmit:t[3]||(t[3]=(0,r.D$)(((...e)=>a.login&&a.login(...e)),["prevent"]))},[(0,n.Lk)("label",null,[t[4]||(t[4]=(0,n.eW)(" Домашний сервер: ")),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.homeServer=e),placeholder:"https://matrix.org",required:""},null,512),[[r.Jo,a.homeServer]])]),(0,n.Lk)("label",null,[t[5]||(t[5]=(0,n.eW)(" Логин: ")),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.username=e),required:""},null,512),[[r.Jo,a.username]])]),(0,n.Lk)("label",null,[t[6]||(t[6]=(0,n.eW)(" Пароль: ")),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.password=e),type:"password",required:""},null,512),[[r.Jo,a.password]])]),t[7]||(t[7]=(0,n.Lk)("button",{type:"submit"},"Вход",-1))],32),a.error?((0,n.uX)(),(0,n.CE)("p",v,(0,d.v_)(a.error),1)):(0,n.Q3)("",!0)])}var p=o(2040),h=o(7222),g={name:"LoginView",setup(){const e=(0,p.KR)(""),t=(0,p.KR)(""),o=(0,p.KR)(""),r=(0,p.KR)(null);localStorage.getItem("matrix_access_token")&&(window.location.href="/rooms");const n=async()=>{r.value=null;try{const r=(0,h.UU6)({baseUrl:e.value}),n=await r.loginWithPassword(t.value,o.value);localStorage.setItem("matrix_access_token",n.access_token),localStorage.setItem("matrix_home_server",e.value),localStorage.setItem("matrix_user_id",n.user_id),window.location.href="/rooms"}catch(n){r.value="Ошибка входа. Проверьте данные.",console.error(n)}};return{homeServer:e,username:t,password:o,error:r,login:n}}};const b=(0,u.A)(g,[["render",f],["__scopeId","data-v-5a1dc69e"]]);var k=b;const y={class:"rooms"},_={class:"controls"},w={class:"sort-controls"},L={key:0},E={key:1},x={class:"room-info"},C={class:"room-avatar-container"},S=["src"],I={key:1};function R(e,t,o,a,l,u){return(0,n.uX)(),(0,n.CE)("div",y,[t[5]||(t[5]=(0,n.Lk)("h1",null,"Ваши чаты",-1)),(0,n.Lk)("div",_,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>u.logout&&u.logout(...e))},"Выйти")]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.searchKeyword=e),placeholder:"Поиск..."},null,512),[[r.Jo,a.searchKeyword]]),(0,n.Lk)("div",w,[t[4]||(t[4]=(0,n.Lk)("label",{for:"sort-by"},"Сортировать по:",-1)),(0,n.bo)((0,n.Lk)("select",{id:"sort-by","onUpdate:modelValue":t[2]||(t[2]=e=>a.sortBy=e)},t[3]||(t[3]=[(0,n.Lk)("option",{value:"lastEvent"},"Последнему событию",-1),(0,n.Lk)("option",{value:"alphabet"},"Алфавиту",-1)]),512),[[r.u1,a.sortBy]])]),a.loading?((0,n.uX)(),(0,n.CE)("div",L,"Загрузка...")):((0,n.uX)(),(0,n.CE)("div",E,[(0,n.Lk)("ul",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.filteredRooms,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.roomId},[(0,n.Lk)("div",x,[(0,n.Lk)("div",C,[e.avatar?((0,n.uX)(),(0,n.CE)("img",{key:0,src:e.avatar,alt:"Аватар не доступен"},null,8,S)):((0,n.uX)(),(0,n.CE)("p",I,"Аватар отсутствует"))]),(0,n.Lk)("div",null,[(0,n.Lk)("h3",null,(0,d.v_)(e.name),1),(0,n.Lk)("p",null,(0,d.v_)(e.lastEvent),1),(0,n.Lk)("small",null,"Непрочитанные: "+(0,d.v_)(e.unreadCount),1)])])])))),128))])]))])}o(8111),o(2489),o(1701);var O={name:"RoomsView",setup(){const e=(0,p.KR)([]),t=(0,p.KR)(""),o=(0,p.KR)(!0),r=(0,p.KR)("lastEvent"),a=async()=>{o.value=!0;const t=(0,h.UU6)({baseUrl:localStorage.getItem("matrix_home_server"),accessToken:localStorage.getItem("matrix_access_token"),userId:localStorage.getItem("matrix_user_id")});await t.startClient(),t.once("sync",(async r=>{if("PREPARED"===r){const r=t.getRooms();e.value=r.map((e=>{const o=e.timeline?.[e.timeline.length-1]?.event;return{roomId:e.roomId,name:e.name||"Без названия",lastEvent:o?.content?.body||"Нет сообщений",lastEventTimestamp:o?.origin_server_ts||0,unreadCount:e.getUnreadNotificationCount("total"),avatar:e.getAvatarUrl(t.getHomeserverUrl(),50,50,"crop",!0)}})),o.value=!1}}))};(0,n.sV)((()=>{a()}));const l=(0,n.EW)((()=>{let o=e.value.filter((e=>e.name.toLowerCase().includes(t.value.toLowerCase())));return"lastEvent"===r.value?o.sort(((e,t)=>t.lastEventTimestamp-e.lastEventTimestamp)):"alphabet"===r.value&&o.sort(((e,t)=>e.name.localeCompare(t.name))),o}));return{rooms:e,searchKeyword:t,loading:o,filteredRooms:l,sortBy:r}},methods:{logout(){localStorage.removeItem("matrix_access_token"),localStorage.removeItem("matrix_home_server"),localStorage.removeItem("matrix_user_id"),window.location.href="/"}}};const U=(0,u.A)(O,[["render",R],["__scopeId","data-v-498fae32"]]);var j=U;const K=[{path:"/",name:"Login",component:k},{path:"/rooms",name:"Rooms",component:j}],A=(0,c.aE)({history:(0,c.LA)(),routes:K});var T=A;(0,r.Ef)(s).use(T).mount("#app")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=e,function(){var e=[];o.O=function(t,r,n,a){if(!r){var l=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],a=e[c][2];for(var u=!0,i=0;i<r.length;i++)(!1&a||l>=a)&&Object.keys(o.O).every((function(e){return o.O[e](r[i])}))?r.splice(i--,1):(u=!1,a<l&&(l=a));if(u){e.splice(c--,1);var s=n();void 0!==s&&(t=s)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,n,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,r){return o.f[r](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/"+e+".0405ec05.js"}}(),function(){o.miniCssF=function(e){}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="matrix-chat-spa:";o.l=function(r,n,a,l){if(e[r])e[r].push(n);else{var u,i;if(void 0!==a)for(var s=document.getElementsByTagName("script"),c=0;c<s.length;c++){var d=s[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+a){u=d;break}}u||(i=!0,u=document.createElement("script"),u.charset="utf-8",u.timeout=120,o.nc&&u.setAttribute("nonce",o.nc),u.setAttribute("data-webpack",t+a),u.src=r),e[r]=[n];var m=function(t,o){u.onerror=u.onload=null,clearTimeout(v);var n=e[r];if(delete e[r],u.parentNode&&u.parentNode.removeChild(u),n&&n.forEach((function(e){return e(o)})),t)return t(o)},v=setTimeout(m.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=m.bind(null,u.onerror),u.onload=m.bind(null,u.onload),i&&document.head.appendChild(u)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/"}(),function(){o.b=document.baseURI||self.location.href;var e={524:0};o.f.j=function(t,r){var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var a=new Promise((function(o,r){n=e[t]=[o,r]}));r.push(n[2]=a);var l=o.p+o.u(t),u=new Error,i=function(r){if(o.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var a=r&&("load"===r.type?"missing":r.type),l=r&&r.target&&r.target.src;u.message="Loading chunk "+t+" failed.\n("+a+": "+l+")",u.name="ChunkLoadError",u.type=a,u.request=l,n[1](u)}};o.l(l,i,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,a,l=r[0],u=r[1],i=r[2],s=0;if(l.some((function(t){return 0!==e[t]}))){for(n in u)o.o(u,n)&&(o.m[n]=u[n]);if(i)var c=i(o)}for(t&&t(r);s<l.length;s++)a=l[s],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},r=self["webpackChunkmatrix_chat_spa"]=self["webpackChunkmatrix_chat_spa"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[504],(function(){return o(5363)}));r=o.O(r)})();
//# sourceMappingURL=app.d881ff86.js.map