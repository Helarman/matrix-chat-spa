"use strict";(self["webpackChunkmatrix_chat_spa"]=self["webpackChunkmatrix_chat_spa"]||[]).push([[904],{3430:function(e,t,r){r.r(t),r.d(t,{Attachment:function(){return se},BackupDecryptionKey:function(){return ce},BackupKeys:function(){return ue},BackupSecretsBundle:function(){return de},BaseMigrationData:function(){return pe},CancelInfo:function(){return we},CheckCode:function(){return fe},CollectStrategy:function(){return ve},CrossSigningBootstrapRequests:function(){return ke},CrossSigningKeyExport:function(){return Re},CrossSigningStatus:function(){return Ke},Curve25519PublicKey:function(){return Ee},DecryptedRoomEvent:function(){return Oe},DecryptionErrorCode:function(){return x},DecryptionSettings:function(){return qe},DehydratedDevice:function(){return Be},DehydratedDeviceKey:function(){return Ue},DehydratedDevices:function(){return Te},Device:function(){return Ne},DeviceId:function(){return ze},DeviceKey:function(){return Le},DeviceKeyAlgorithm:function(){return Ge},DeviceKeyAlgorithmName:function(){return z},DeviceKeyId:function(){return Je},DeviceKeyName:function(){return j},DeviceLists:function(){return Ye},Ecies:function(){return $e},Ed25519PublicKey:function(){return et},Ed25519Signature:function(){return rt},Emoji:function(){return it},EncryptedAttachment:function(){return st},EncryptionAlgorithm:function(){return L},EncryptionInfo:function(){return ct},EncryptionSettings:function(){return ut},EstablishedEcies:function(){return dt},EventId:function(){return pt},HistoryVisibility:function(){return W},IdentityKeys:function(){return wt},InboundCreationResult:function(){return ft},InboundGroupSession:function(){return vt},KeysBackupRequest:function(){return kt},KeysClaimRequest:function(){return Rt},KeysQueryRequest:function(){return Kt},KeysUploadRequest:function(){return Et},LocalTrust:function(){return G},LoggerLevel:function(){return Q},MaybeSignature:function(){return Ot},MegolmDecryptionError:function(){return qt},MegolmV1BackupKey:function(){return Bt},Migration:function(){return Ut},OlmMachine:function(){return Tt},OtherUserIdentity:function(){return Nt},OutboundCreationResult:function(){return zt},OwnUserIdentity:function(){return Lt},PickledInboundGroupSession:function(){return Gt},PickledSession:function(){return Jt},PutDehydratedDeviceRequest:function(){return Yt},Qr:function(){return $t},QrCode:function(){return er},QrCodeData:function(){return rr},QrCodeMode:function(){return J},QrCodeScan:function(){return ir},QrState:function(){return H},RehydratedDevice:function(){return sr},RequestType:function(){return Y},RoomId:function(){return cr},RoomKeyCounts:function(){return ur},RoomKeyImportResult:function(){return dr},RoomKeyInfo:function(){return pr},RoomKeyWithheldInfo:function(){return wr},RoomMessageRequest:function(){return fr},RoomSettings:function(){return vr},Sas:function(){return kr},SecretsBundle:function(){return Rr},ServerName:function(){return Kr},ShieldColor:function(){return X},ShieldState:function(){return Er},ShieldStateCode:function(){return $},Signature:function(){return Or},SignatureState:function(){return Z},SignatureUploadRequest:function(){return qr},SignatureVerification:function(){return Br},Signatures:function(){return Ur},StoreHandle:function(){return Tr},ToDeviceRequest:function(){return Nr},Tracing:function(){return zr},TrustRequirement:function(){return ee},UploadSigningKeysRequest:function(){return Lr},UserDevices:function(){return Gr},UserId:function(){return Jr},VerificationMethod:function(){return te},VerificationRequest:function(){return Yr},VerificationRequestPhase:function(){return re},Versions:function(){return $r},__wbg_String_8f0eb39a4a4c2f66:function(){return Zr},__wbg_String_eecc4a11987127d6:function(){return en},__wbg_Window_b0044ac7db258535:function(){return tn},__wbg_WorkerGlobalScope_b74cefefc62a37da:function(){return rn},__wbg_add_0d9e99fb9c2d2cc5:function(){return nn},__wbg_add_c836e3d4b14cd062:function(){return on},__wbg_at_479807bfddde3a33:function(){return sn},__wbg_backupkeys_new:function(){return _n},__wbg_bound_1918c0826c5b9363:function(){return cn},__wbg_bound_324dfb8899c9798c:function(){return an},__wbg_buffer_61b7ce01341d7f88:function(){return un},__wbg_call_3b770f0d6eb4720e:function(){return gn},__wbg_call_500db948e69c7330:function(){return dn},__wbg_call_9bd6f269d4835e33:function(){return ln},__wbg_call_b0d8e36992d9900d:function(){return pn},__wbg_clearTimeout_5a54f8841c30079a:function(){return yn},__wbg_clear_da83758e0bea0eb6:function(){return wn},__wbg_close_f6e618ed8b0326a3:function(){return hn},__wbg_code_71136b86e2aa7f41:function(){return fn},__wbg_continue_bd44561c014cacea:function(){return bn},__wbg_count_244aa4118e005b59:function(){return vn},__wbg_count_4df50ef6c1ddd770:function(){return mn},__wbg_createIndex_14571b3c4eec1628:function(){return kn},__wbg_createIndex_1d4b2bbb6b21b8f8:function(){return Sn},__wbg_createObjectStore_b6f14aa10f83a300:function(){return Rn},__wbg_crosssigningbootstraprequests_new:function(){return In},__wbg_crosssigningkeyexport_new:function(){return Kn},__wbg_crosssigningstatus_new:function(){return Cn},__wbg_crypto_ed58b8e10a292839:function(){return En},__wbg_debug_156ca727dbc3150f:function(){return Dn},__wbg_debug_3acd668e6e6c6087:function(){return On},__wbg_decryptedroomevent_new:function(){return Mn},__wbg_dehydrateddevice_new:function(){return qn},__wbg_dehydrateddevicekey_new:function(){return An},__wbg_deleteObjectStore_1f50ba0263875deb:function(){return Bn},__wbg_delete_5c33e4966f59624d:function(){return Vn},__wbg_delete_d97b2b4ff716c553:function(){return Un},__wbg_device_new:function(){return Fn},__wbg_deviceid_new:function(){return Tn},__wbg_devicekey_new:function(){return Pn},__wbg_devicekeyid_new:function(){return Nn},__wbg_done_f22c1561fa919baa:function(){return xn},__wbg_emoji_new:function(){return zn},__wbg_encryptioninfo_new:function(){return jn},__wbg_entries_4f2bb9b0d701c0f6:function(){return Ln},__wbg_entries_82bf0e755ef54a5f:function(){return Wn},__wbg_error_32fda676ae978f6e:function(){return Gn},__wbg_error_7534b8e9a36f1ab4:function(){return Qn},__wbg_error_77233c625ed0c533:function(){return Jn},__wbg_error_fab41a42d22bf2bc:function(){return Hn},__wbg_from_d68eaa96dba25449:function(){return Yn},__wbg_getAllKeys_ad97dc28822a6891:function(){return Xn},__wbg_getAll_72e2faaa06d1a8cf:function(){return $n},__wbg_getAll_8f38031e5969c7f5:function(){return Zn},__wbg_getAll_8fa84589faccab36:function(){return ei},__wbg_getRandomValues_bcb4912f16000dc4:function(){return ti},__wbg_getTime_ab8b72009983c537:function(){return ri},__wbg_get_6a4f854f5cca7403:function(){return ni},__wbg_get_7081edc0440983a5:function(){return ii},__wbg_get_9aa3dff3f0266054:function(){return oi},__wbg_get_bbccf8970793c087:function(){return si},__wbg_getwithrefkey_1dc361bd10053bfe:function(){return _i},__wbg_getwithrefkey_6550b2c093d2eb18:function(){return ci},__wbg_global_b6f5c73312f62313:function(){return ai},__wbg_inboundgroupsession_new:function(){return ui},__wbg_index_871d874253bae760:function(){return gi},__wbg_indexedDB_601ec26c63e333de:function(){return di},__wbg_indexedDB_72e2ca071222fd9e:function(){return li},__wbg_indexedDB_e34a5e9b3d2fcfa1:function(){return pi},__wbg_info_c3044c86ae29faab:function(){return yi},__wbg_info_ed71056bef15b91a:function(){return wi},__wbg_instanceof_ArrayBuffer_670ddde44cdb2602:function(){return hi},__wbg_instanceof_Map_98ecb30afec5acdb:function(){return fi},__wbg_instanceof_Promise_0aa3a90cfe6672c9:function(){return bi},__wbg_instanceof_Uint8Array_28af5bc19d6acad8:function(){return vi},__wbg_isArray_1ba11a930108ec51:function(){return mi},__wbg_isSafeInteger_12f5549b2fca23f4:function(){return ki},__wbg_item_7156a8ffa4d816bc:function(){return Si},__wbg_iterator_23604bb983791576:function(){return Ri},__wbg_key_87db8226759da642:function(){return Ii},__wbg_keysbackuprequest_new:function(){return Ki},__wbg_keysclaimrequest_new:function(){return Ci},__wbg_keysqueryrequest_new:function(){return Ei},__wbg_keysuploadrequest_new:function(){return Di},__wbg_length_65d1cd11729ced11:function(){return Oi},__wbg_length_d65cf0786bfc5739:function(){return Mi},__wbg_length_f4d79409aa324811:function(){return qi},__wbg_lowerBound_3aa47caa33c7e1e6:function(){return Ai},__wbg_maybesignature_new:function(){return Bi},__wbg_megolmdecryptionerror_new:function(){return Vi},__wbg_message_d19bdb65f0a41cf5:function(){return Ui},__wbg_msCrypto_0a36e2ec3a343d26:function(){return Fi},__wbg_name_8862cd49ad807c59:function(){return Ti},__wbg_new_0f1bd659dcd47068:function(){return Pi},__wbg_new_254fa9eac11932ae:function(){return Ni},__wbg_new_3d446df9155128ef:function(){return xi},__wbg_new_3ff5b33b1ce712df:function(){return zi},__wbg_new_41257536af60ed14:function(){return ji},__wbg_new_688846f374351c92:function(){return Li},__wbg_new_8a6f238a6ece86ea:function(){return Wi},__wbg_new_9451f3dcb42e0e37:function(){return Gi},__wbg_new_bc96c6a1c0786643:function(){return Qi},__wbg_newnoargs_fd9e4bf8be2bc16d:function(){return Ji},__wbg_newwithbyteoffsetandlength_ba35896968751d91:function(){return Hi},__wbg_newwithbyteoffsetandlength_c0c90653f73c7dfb:function(){return Yi},__wbg_newwithlength_2aede0ef4e6e97ec:function(){return Xi},__wbg_newwithlength_34ce8f1051e74449:function(){return $i},__wbg_newwithmessage_80e6436058862fd4:function(){return Zi},__wbg_next_01dd9234a5bf6d05:function(){return eo},__wbg_next_137428deb98342b0:function(){return to},__wbg_node_02999533c4ea02e3:function(){return ro},__wbg_now_2c95c9de01293173:function(){return no},__wbg_now_64d0bb151e5d3889:function(){return io},__wbg_objectStoreNames_cb00c8113b3cf5df:function(){return oo},__wbg_objectStore_cdbc73ee600a2cfa:function(){return so},__wbg_oldVersion_a31d9f8577239dd8:function(){return _o},__wbg_olmmachine_new:function(){return co},__wbg_openCursor_37e21d9af1a61159:function(){return ao},__wbg_openCursor_da08cc74542711ad:function(){return uo},__wbg_openCursor_e7a3f6453a0f6725:function(){return go},__wbg_open_4588c85c0c43671d:function(){return lo},__wbg_open_5c51d4d6d7ab6da6:function(){return po},__wbg_otheruseridentity_new:function(){return yo},__wbg_ownuseridentity_new:function(){return wo},__wbg_parse_161c68378e086ae1:function(){return ho},__wbg_performance_7a3ffd0b17f663ad:function(){return fo},__wbg_pickledinboundgroupsession_unwrap:function(){return bo},__wbg_pickledsession_unwrap:function(){return vo},__wbg_process_5c1d670bc53614b8:function(){return mo},__wbg_push_6edad0df4b546b2c:function(){return ko},__wbg_put_5393e88dbe742e8f:function(){return So},__wbg_putdehydrateddevicerequest_new:function(){return Ro},__wbg_qr_new:function(){return Io},__wbg_queueMicrotask_2181040e064c0dc8:function(){return Ko},__wbg_queueMicrotask_ef9ac43769cbcc4f:function(){return Co},__wbg_randomFillSync_ab2cfe79ebbf2740:function(){return Eo},__wbg_readyState_8428fa7c5e093401:function(){return Do},__wbg_rehydrateddevice_new:function(){return Oo},__wbg_require_79b1e9274cde3c87:function(){return Mo},__wbg_resolve_0bf7c44d641804f9:function(){return qo},__wbg_result_e6ba6a347dcb7470:function(){return Ao},__wbg_roomid_unwrap:function(){return Bo},__wbg_roomkeycounts_new:function(){return Vo},__wbg_roomkeyimportresult_new:function(){return Uo},__wbg_roomkeyinfo_new:function(){return Fo},__wbg_roomkeywithheldinfo_new:function(){return To},__wbg_roommessagerequest_new:function(){return Po},__wbg_roomsettings_new:function(){return No},__wbg_sas_new:function(){return xo},__wbg_secretsbundle_new:function(){return zo},__wbg_setTimeout_db2dbaeefb6f39c7:function(){return jo},__wbg_set_1d80752d0d5f0b21:function(){return Lo},__wbg_set_23d69db4e5c66a6e:function(){return Wo},__wbg_set_3807d5f0bfc24aa7:function(){return Go},__wbg_set_3f1d0b984ed272ed:function(){return Qo},__wbg_set_76818dc3c59a63d5:function(){return Jo},__wbg_set_9592f7d5b752cae3:function(){return Ho},__wbg_set_wasm:function(){return i},__wbg_setonabort_ade6cac5c35a572f:function(){return Yo},__wbg_setonblocked_d13048be9383f4dc:function(){return Xo},__wbg_setoncomplete_2747fb71ae0af4a8:function(){return $o},__wbg_setonerror_72b33e31f9edb045:function(){return Zo},__wbg_setonerror_e4beb2652cf66635:function(){return es},__wbg_setonsuccess_57167b1c2650357c:function(){return ts},__wbg_setonupgradeneeded_887c7a5fca66011e:function(){return rs},__wbg_setonversionchange_a6f60bd1d110795d:function(){return ns},__wbg_setunique_cfc477dc5825e1c4:function(){return is},__wbg_signatures_new:function(){return os},__wbg_signatureuploadrequest_new:function(){return ss},__wbg_signatureverification_new:function(){return _s},__wbg_stack_0ed75d68575b0f3c:function(){return cs},__wbg_static_accessor_GLOBAL_0be7472e492ad3e3:function(){return as},__wbg_static_accessor_GLOBAL_THIS_1a6eb482d12c9bfb:function(){return us},__wbg_static_accessor_SELF_1dc398a895c82351:function(){return gs},__wbg_static_accessor_WINDOW_ae1c80c7eea8d64a:function(){return ds},__wbg_storehandle_new:function(){return ls},__wbg_stringify_f4f701bc34ceda61:function(){return ps},__wbg_subarray_46adeb9b86949d12:function(){return ys},__wbg_target_a8fe593e7ee79c21:function(){return ws},__wbg_then_0438fad860fe38e1:function(){return hs},__wbg_then_0ffafeddf0e182a4:function(){return fs},__wbg_todevicerequest_new:function(){return bs},__wbg_transaction_bc71c2aaaf467420:function(){return vs},__wbg_transaction_d2b6d520837fbe7f:function(){return ms},__wbg_transaction_dbab9cd9ea849958:function(){return ks},__wbg_update_211ddccaf2cec6ee:function(){return Ss},__wbg_userdevices_new:function(){return Rs},__wbg_userid_new:function(){return Is},__wbg_userid_unwrap:function(){return Ks},__wbg_value_0ad6f37677c8ee74:function(){return Cs},__wbg_value_4c32fd138a88eee2:function(){return Es},__wbg_values_7aa03dd078978c86:function(){return Ds},__wbg_verificationrequest_new:function(){return Os},__wbg_version_2b650c9d4f0a2438:function(){return Ms},__wbg_versions_c71aa1626a93e0a1:function(){return qs},__wbg_warn_123db6aa8948382e:function(){return As},__wbg_warn_9d038df1589cb1bd:function(){return Bs},__wbindgen_as_number:function(){return Vs},__wbindgen_bigint_from_i64:function(){return Us},__wbindgen_bigint_from_u64:function(){return Fs},__wbindgen_bigint_get_as_i64:function(){return Ts},__wbindgen_boolean_get:function(){return Ps},__wbindgen_cb_drop:function(){return Ns},__wbindgen_closure_wrapper1050:function(){return xs},__wbindgen_closure_wrapper2213:function(){return zs},__wbindgen_closure_wrapper5386:function(){return js},__wbindgen_closure_wrapper6843:function(){return Ls},__wbindgen_closure_wrapper6848:function(){return Ws},__wbindgen_debug_string:function(){return Gs},__wbindgen_error_new:function(){return Qs},__wbindgen_in:function(){return Js},__wbindgen_init_externref_table:function(){return Hs},__wbindgen_is_array:function(){return Ys},__wbindgen_is_bigint:function(){return Xs},__wbindgen_is_function:function(){return $s},__wbindgen_is_null:function(){return Zs},__wbindgen_is_object:function(){return e_},__wbindgen_is_string:function(){return t_},__wbindgen_is_undefined:function(){return r_},__wbindgen_jsval_eq:function(){return n_},__wbindgen_jsval_loose_eq:function(){return i_},__wbindgen_memory:function(){return o_},__wbindgen_number_get:function(){return s_},__wbindgen_number_new:function(){return __},__wbindgen_string_get:function(){return c_},__wbindgen_string_new:function(){return a_},__wbindgen_throw:function(){return u_},__wbindgen_try_into_number:function(){return g_},getVersions:function(){return A},start:function(){return B}});r(4114),r(6573),r(8100),r(7936),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(7467),r(4732),r(9577),r(4979);let n;function i(e){n=e}e=r.hmd(e);let o=0,s=null;function _(){return null!==s&&0!==s.byteLength||(s=new Uint8Array(n.memory.buffer)),s}const c="undefined"===typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder;let a=new c("utf-8");const u="function"===typeof a.encodeInto?function(e,t){return a.encodeInto(e,t)}:function(e,t){const r=a.encode(e);return t.set(r),{read:e.length,written:r.length}};function g(e,t,r){if(void 0===r){const r=a.encode(e),n=t(r.length,1)>>>0;return _().subarray(n,n+r.length).set(r),o=r.length,n}let n=e.length,i=t(n,1)>>>0;const s=_();let c=0;for(;c<n;c++){const t=e.charCodeAt(c);if(t>127)break;s[i+c]=t}if(c!==n){0!==c&&(e=e.slice(c)),i=r(i,n,n=c+3*e.length,1)>>>0;const t=_().subarray(i+c,i+n),o=u(e,t);c+=o.written,i=r(i,n,c,1)>>>0}return o=c,i}let d=null;function l(){return(null===d||!0===d.buffer.detached||void 0===d.buffer.detached&&d.buffer!==n.memory.buffer)&&(d=new DataView(n.memory.buffer)),d}function p(e){const t=n.__externref_table_alloc();return n.__wbindgen_export_4.set(t,e),t}function y(e,t){try{return e.apply(this,t)}catch(r){const e=p(r);n.__wbindgen_exn_store(e)}}const w="undefined"===typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder;let h=new w("utf-8",{ignoreBOM:!0,fatal:!0});function f(e,t){return e>>>=0,h.decode(_().subarray(e,e+t))}function b(e){return void 0===e||null===e}h.decode();const v="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{n.__wbindgen_export_6.get(e.dtor)(e.a,e.b)}));function m(e,t,r,i){const o={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{o.cnt++;const t=o.a;o.a=0;try{return i(t,o.b,...e)}finally{0===--o.cnt?(n.__wbindgen_export_6.get(o.dtor)(t,o.b),v.unregister(o)):o.a=t}};return s.original=o,v.register(s,o,o),s}function k(e,t,r,i){const o={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{o.cnt++;try{return i(o.a,o.b,...e)}finally{0===--o.cnt&&(n.__wbindgen_export_6.get(o.dtor)(o.a,o.b),o.a=0,v.unregister(o))}};return s.original=o,v.register(s,o,o),s}function S(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=S(e[0]));for(let n=1;n<t;n++)r+=", "+S(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r&&r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(i){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function R(e,t){const r=t(1*e.length,1)>>>0;return _().set(e,r/1),o=e.length,r}function I(e){const t=n.__wbindgen_export_4.get(e);return n.__externref_table_dealloc(e),t}function K(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function C(e,t){return e>>>=0,_().subarray(e/1,e/1+t)}function E(e,t){const r=t(4*e.length,4)>>>0,n=l();for(let i=0;i<e.length;i++)n.setUint32(r+4*i,p(e[i]),!0);return o=e.length,r}function D(e,t){e>>>=0;const r=l(),i=[];for(let o=e;o<e+4*t;o+=4)i.push(n.__wbindgen_export_4.get(r.getUint32(o,!0)));return n.__externref_drop_slice(e,t),i}let O=null;function M(){return null!==O&&0!==O.byteLength||(O=new Uint16Array(n.memory.buffer)),O}function q(e,t){return e>>>=0,M().subarray(e/2,e/2+t)}function A(){const e=n.getVersions();return $r.__wrap(e)}function B(){n.start()}function V(e,t,r){const i=n.closure29_externref_shim_multivalue_shim(e,t,r);if(i[1])throw I(i[0])}function U(e,t){n._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__heca5c4426cc7e703(e,t)}function F(e,t,r){n.closure735_externref_shim(e,t,r)}function T(e,t,r){n.closure415_externref_shim(e,t,r)}function P(e,t){n._dyn_core__ops__function__Fn_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h41d552962a79dfb4(e,t)}function N(e,t,r,i){n.closure431_externref_shim(e,t,r,i)}const x=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt"}),z=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),j=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),L=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),W=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),G=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),Q=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),J=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),H=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),Y=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),X=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),$=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation"}),Z=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),ee=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),te=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),re=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),ne=["pending","done"],ie=["readonly","readwrite","versionchange","readwriteflush","cleanup"],oe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_attachment_free(e>>>0,1)));class se{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_attachment_free(e,0)}static encrypt(e){const t=R(e,n.__wbindgen_malloc),r=o,i=n.attachment_encrypt(t,r);if(i[2])throw I(i[1]);return st.__wrap(i[0])}static decrypt(e){K(e,st);const t=n.attachment_decrypt(e.__wbg_ptr);if(t[3])throw I(t[2]);var r=C(t[0],t[1]).slice();return n.__wbindgen_free(t[0],1*t[1],1),r}}const _e="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupdecryptionkey_free(e>>>0,1)));class ce{static __wrap(e){e>>>=0;const t=Object.create(ce.prototype);return t.__wbg_ptr=e,_e.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_e.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=n.backupdecryptionkey_createRandomKey();return ce.__wrap(e)}static fromBase64(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.backupdecryptionkey_fromBase64(t,r);if(i[2])throw I(i[1]);return ce.__wrap(i[0])}toBase64(){const e=n.backupdecryptionkey_toBase64(this.__wbg_ptr);return e}get megolmV1PublicKey(){const e=n.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return Bt.__wrap(e)}decryptV1(e,t,r){let i,s;try{const a=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),u=o,d=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),l=o,p=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),y=o,w=n.backupdecryptionkey_decryptV1(this.__wbg_ptr,a,u,d,l,p,y);var _=w[0],c=w[1];if(w[3])throw _=0,c=0,I(w[2]);return i=_,s=c,f(_,c)}finally{n.__wbindgen_free(i,s,1)}}}const ae="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupkeys_free(e>>>0,1)));class ue{static __wrap(e){e>>>=0;const t=Object.create(ue.prototype);return t.__wbg_ptr=e,ae.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ae.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=n.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return 0===e?void 0:ce.__wrap(e)}set decryptionKey(e){let t=0;b(e)||(K(e,ce),t=e.__destroy_into_raw()),n.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=n.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){const e=n.backupkeys_decryptionKeyBase64(this.__wbg_ptr);return e}}const ge="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_backupsecretsbundle_free(e>>>0,1)));class de{static __wrap(e){e>>>=0;const t=Object.create(de.prototype);return t.__wbg_ptr=e,ge.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ge.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set key(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set backup_version(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}}const le="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_basemigrationdata_free(e>>>0,1)));class pe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,le.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_basemigrationdata_free(e,0)}get userId(){const e=n.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return 0===e?void 0:Jr.__wrap(e)}set userId(e){let t=0;b(e)||(K(e,Jr),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=n.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return 0===e?void 0:ze.__wrap(e)}set deviceId(e){let t=0;b(e)||(K(e,ze),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=n.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=n.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=n.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set backupRecoveryKey(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningMasterKey(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningSelfSigningKey(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningUserSigningKey(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=n.basemigrationdata_new();return this.__wbg_ptr=e>>>0,le.register(this,this.__wbg_ptr,this),this}}const ye="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_cancelinfo_free(e>>>0,1)));class we{static __wrap(e){e>>>=0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,ye.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ye.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_cancelinfo_free(e,0)}reason(){const e=n.cancelinfo_reason(this.__wbg_ptr);return e}cancelCode(){let e,t;try{const r=n.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}cancelledbyUs(){const e=n.cancelinfo_cancelledbyUs(this.__wbg_ptr);return 0!==e}}const he="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_checkcode_free(e>>>0,1)));class fe{static __wrap(e){e>>>=0;const t=Object.create(fe.prototype);return t.__wbg_ptr=e,he.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,he.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_checkcode_free(e,0)}as_bytes(){const e=n.checkcode_as_bytes(this.__wbg_ptr);var t=C(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}to_digit(){const e=n.checkcode_to_digit(this.__wbg_ptr);return e}}const be="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_collectstrategy_free(e>>>0,1)));class ve{static __wrap(e){e>>>=0;const t=Object.create(ve.prototype);return t.__wbg_ptr=e,be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,be.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_collectstrategy_free(e,0)}eq(e){K(e,ve);const t=n.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr);return 0!==t}static deviceBasedStrategy(e,t){const r=n.collectstrategy_deviceBasedStrategy(e,t);return ve.__wrap(r)}static identityBasedStrategy(){const e=n.collectstrategy_identityBasedStrategy();return ve.__wrap(e)}}const me="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningbootstraprequests_free(e>>>0,1)));class ke{static __wrap(e){e>>>=0;const t=Object.create(ke.prototype);return t.__wbg_ptr=e,me.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,me.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr);return e}get uploadSigningKeysRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return Lr.__wrap(e)}get uploadSignaturesRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return qr.__wrap(e)}}const Se="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningkeyexport_free(e>>>0,1)));class Re{static __wrap(e){e>>>=0;const t=Object.create(Re.prototype);return t.__wbg_ptr=e,Se.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Se.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=n.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get self_signing_key(){const e=n.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get userSigningKey(){const e=n.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const Ie="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_crosssigningstatus_free(e>>>0,1)));class Ke{static __wrap(e){e>>>=0;const t=Object.create(Ke.prototype);return t.__wbg_ptr=e,Ie.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ie.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){const e=n.crosssigningstatus_hasMaster(this.__wbg_ptr);return 0!==e}get hasSelfSigning(){const e=n.crosssigningstatus_hasSelfSigning(this.__wbg_ptr);return 0!==e}get hasUserSigning(){const e=n.crosssigningstatus_hasUserSigning(this.__wbg_ptr);return 0!==e}}const Ce="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_curve25519publickey_free(e>>>0,1)));class Ee{static __wrap(e){e>>>=0;const t=Object.create(Ee.prototype);return t.__wbg_ptr=e,Ce.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ce.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.curve25519publickey_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,Ce.register(this,this.__wbg_ptr,this),this}get length(){const e=n.curve25519publickey_length(this.__wbg_ptr);return e>>>0}toBase64(){let e,t;try{const r=n.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const De="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_decryptedroomevent_free(e>>>0,1)));class Oe{static __wrap(e){e>>>=0;const t=Object.create(Oe.prototype);return t.__wbg_ptr=e,De.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,De.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedroomevent_free(e,0)}get event(){const e=n.__wbg_get_decryptedroomevent_event(this.__wbg_ptr);return e}get sender(){const e=n.decryptedroomevent_sender(this.__wbg_ptr);return 0===e?void 0:Jr.__wrap(e)}get senderDevice(){const e=n.decryptedroomevent_senderDevice(this.__wbg_ptr);return 0===e?void 0:ze.__wrap(e)}get senderCurve25519Key(){const e=n.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr);return e}get senderClaimedEd25519Key(){const e=n.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr);return e}get forwardingCurve25519KeyChain(){const e=n.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr);return e}shieldState(e){const t=n.decryptedroomevent_shieldState(this.__wbg_ptr,e);return 0===t?void 0:Er.__wrap(t)}}const Me="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_decryptionsettings_free(e>>>0,1)));class qe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Me.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){const e=n.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr);return e}set sender_device_trust_requirement(e){n.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=n.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,Me.register(this,this.__wbg_ptr,this),this}}const Ae="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevice_free(e>>>0,1)));class Be{static __wrap(e){e>>>=0;const t=Object.create(Be.prototype);return t.__wbg_ptr=e,Ae.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ae.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){K(t,Ue);const r=n.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr);return r}}const Ve="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevicekey_free(e>>>0,1)));class Ue{static __wrap(e){e>>>=0;const t=Object.create(Ue.prototype);return t.__wbg_ptr=e,Ve.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ve.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=n.dehydrateddevicekey_createRandomKey();if(e[2])throw I(e[1]);return Ue.__wrap(e[0])}static createKeyFromArray(e){const t=n.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw I(t[1]);return Ue.__wrap(t[0])}toBase64(){const e=n.dehydrateddevicekey_toBase64(this.__wbg_ptr);return e}}const Fe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_dehydrateddevices_free(e>>>0,1)));class Te{static __wrap(e){e>>>=0;const t=Object.create(Te.prototype);return t.__wbg_ptr=e,Fe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevices_free(e,0)}create(){const e=n.dehydrateddevices_create(this.__wbg_ptr);return e}rehydrate(e,t,r){K(e,Ue),K(t,ze);const i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=n.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i,s);return _}getDehydratedDeviceKey(){const e=n.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr);return e}saveDehydratedDeviceKey(e){K(e,Ue);const t=n.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr);return t}deleteDehydratedDeviceKey(){const e=n.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr);return e}}const Pe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_device_free(e>>>0,1)));class Ne{static __wrap(e){e>>>=0;const t=Object.create(Ne.prototype);return t.__wbg_ptr=e,Pe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_device_free(e,0)}requestVerification(e){var t=b(e)?0:E(e,n.__wbindgen_malloc),r=o;const i=n.device_requestVerification(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return I(i[0])}encryptToDeviceEvent(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.device_encryptToDeviceEvent(this.__wbg_ptr,r,i,t);return s}isVerified(){const e=n.device_isVerified(this.__wbg_ptr);return 0!==e}isCrossSigningTrusted(){const e=n.device_isCrossSigningTrusted(this.__wbg_ptr);return 0!==e}isCrossSignedByOwner(){const e=n.device_isCrossSignedByOwner(this.__wbg_ptr);return 0!==e}setLocalTrust(e){const t=n.device_setLocalTrust(this.__wbg_ptr,e);return t}get userId(){const e=n.device_userId(this.__wbg_ptr);return Jr.__wrap(e)}get deviceId(){const e=n.device_deviceId(this.__wbg_ptr);return ze.__wrap(e)}get displayName(){const e=n.device_displayName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}getKey(e){const t=n.device_getKey(this.__wbg_ptr,e);if(t[2])throw I(t[1]);return 0===t[0]?void 0:Le.__wrap(t[0])}get curve25519Key(){const e=n.device_curve25519Key(this.__wbg_ptr);return 0===e?void 0:Ee.__wrap(e)}get ed25519Key(){const e=n.device_ed25519Key(this.__wbg_ptr);return 0===e?void 0:et.__wrap(e)}get keys(){const e=n.device_keys(this.__wbg_ptr);return e}get algorithms(){const e=n.device_algorithms(this.__wbg_ptr);return e}get signatures(){const e=n.device_signatures(this.__wbg_ptr);return Ur.__wrap(e)}get localTrustState(){const e=n.device_localTrustState(this.__wbg_ptr);return e}isLocallyTrusted(){const e=n.device_isLocallyTrusted(this.__wbg_ptr);return 0!==e}isBlacklisted(){const e=n.device_isBlacklisted(this.__wbg_ptr);return 0!==e}isDeleted(){const e=n.device_isDeleted(this.__wbg_ptr);return 0!==e}firstTimeSeen(){const e=n.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){const e=n.device_verify(this.__wbg_ptr);return e}get isDehydrated(){const e=n.device_isDehydrated(this.__wbg_ptr);return 0!==e}}const xe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_deviceid_free(e>>>0,1)));class ze{static __wrap(e){e>>>=0;const t=Object.create(ze.prototype);return t.__wbg_ptr=e,xe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_deviceid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.deviceid_new(t,r);return this.__wbg_ptr=i>>>0,xe.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const je="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekey_free(e>>>0,1)));class Le{static __wrap(e){e>>>=0;const t=Object.create(Le.prototype);return t.__wbg_ptr=e,je.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,je.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekey_free(e,0)}get name(){const e=n.devicekey_name(this.__wbg_ptr);return e}get curve25519(){const e=n.devicekey_curve25519(this.__wbg_ptr);return 0===e?void 0:Ee.__wrap(e)}get ed25519(){const e=n.devicekey_ed25519(this.__wbg_ptr);return 0===e?void 0:et.__wrap(e)}get unknown(){const e=n.devicekey_unknown(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}toBase64(){let e,t;try{const r=n.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const We="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekeyalgorithm_free(e>>>0,1)));class Ge{static __wrap(e){e>>>=0;const t=Object.create(Ge.prototype);return t.__wbg_ptr=e,We.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,We.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyalgorithm_free(e,0)}get name(){const e=n.devicekeyalgorithm_name(this.__wbg_ptr);return e}toString(){let e,t;try{const r=n.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Qe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicekeyid_free(e>>>0,1)));class Je{static __wrap(e){e>>>=0;const t=Object.create(Je.prototype);return t.__wbg_ptr=e,Qe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.devicekeyid_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,Qe.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=n.devicekeyid_algorithm(this.__wbg_ptr);return Ge.__wrap(e)}get deviceId(){const e=n.devicekeyid_deviceId(this.__wbg_ptr);return ze.__wrap(e)}toString(){let e,t;try{const r=n.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const He="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_devicelists_free(e>>>0,1)));class Ye{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,He.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicelists_free(e,0)}constructor(e,t){var r=b(e)?0:E(e,n.__wbindgen_malloc),i=o,s=b(t)?0:E(t,n.__wbindgen_malloc),_=o;const c=n.devicelists_new(r,i,s,_);if(c[2])throw I(c[1]);return this.__wbg_ptr=c[0]>>>0,He.register(this,this.__wbg_ptr,this),this}isEmpty(){const e=n.devicelists_isEmpty(this.__wbg_ptr);return 0!==e}get changed(){const e=n.devicelists_changed(this.__wbg_ptr);var t=D(e[0],e[1]).slice();return n.__wbindgen_free(e[0],4*e[1],4),t}get left(){const e=n.devicelists_left(this.__wbg_ptr);var t=D(e[0],e[1]).slice();return n.__wbindgen_free(e[0],4*e[1],4),t}}const Xe="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ecies_free(e>>>0,1)));class $e{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xe.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ecies_free(e,0)}constructor(){const e=n.ecies_new();return this.__wbg_ptr=e>>>0,Xe.register(this,this.__wbg_ptr,this),this}public_key(){const e=n.ecies_public_key(this.__wbg_ptr);return Ee.__wrap(e)}establish_inbound_channel(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return ft.__wrap(i[0])}establish_outbound_channel(e,t){K(e,Ee);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,i);if(s[2])throw I(s[1]);return zt.__wrap(s[0])}}const Ze="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ed25519publickey_free(e>>>0,1)));class et{static __wrap(e){e>>>=0;const t=Object.create(et.prototype);return t.__wbg_ptr=e,Ze.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ze.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519publickey_free(e,0)}get length(){const e=n.ed25519publickey_length(this.__wbg_ptr);return e>>>0}toBase64(){let e,t;try{const r=n.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const tt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ed25519signature_free(e>>>0,1)));class rt{static __wrap(e){e>>>=0;const t=Object.create(rt.prototype);return t.__wbg_ptr=e,tt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,tt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519signature_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.ed25519signature_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,tt.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=n.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const nt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_emoji_free(e>>>0,1)));class it{static __wrap(e){e>>>=0;const t=Object.create(it.prototype);return t.__wbg_ptr=e,nt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,nt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_emoji_free(e,0)}get symbol(){const e=n.emoji_symbol(this.__wbg_ptr);return e}get description(){const e=n.emoji_description(this.__wbg_ptr);return e}}const ot="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptedattachment_free(e>>>0,1)));class st{static __wrap(e){e>>>=0;const t=Object.create(st.prototype);return t.__wbg_ptr=e,ot.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ot.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=R(e,n.__wbindgen_malloc),i=o,s=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o,c=n.encryptedattachment_new(r,i,s,_);if(c[2])throw I(c[1]);return this.__wbg_ptr=c[0]>>>0,ot.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=n.encryptedattachment_encryptedData(this.__wbg_ptr);var t=C(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}get mediaEncryptionInfo(){const e=n.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get hasMediaEncryptionInfoBeenConsumed(){const e=n.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr);return 0!==e}}const _t="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptioninfo_free(e>>>0,1)));class ct{static __wrap(e){e>>>=0;const t=Object.create(ct.prototype);return t.__wbg_ptr=e,_t.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_t.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptioninfo_free(e,0)}get sender(){const e=n.encryptioninfo_sender(this.__wbg_ptr);return Jr.__wrap(e)}get senderDevice(){const e=n.encryptioninfo_senderDevice(this.__wbg_ptr);return 0===e?void 0:ze.__wrap(e)}get senderCurve25519Key(){const e=n.encryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e}get senderClaimedEd25519Key(){const e=n.encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr);return e}shieldState(e){const t=n.encryptioninfo_shieldState(this.__wbg_ptr,e);return Er.__wrap(t)}}const at="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_encryptionsettings_free(e>>>0,1)));class ut{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,at.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptionsettings_free(e,0)}get algorithm(){const e=n.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr);return e}set algorithm(e){n.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get rotationPeriod(){const e=n.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){n.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=n.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){n.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){const e=n.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr);return e}set historyVisibility(e){n.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=n.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return ve.__wrap(e)}set sharingStrategy(e){K(e,ve);var t=e.__destroy_into_raw();n.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=n.encryptionsettings_new();return this.__wbg_ptr=e>>>0,at.register(this,this.__wbg_ptr,this),this}}const gt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_establishedecies_free(e>>>0,1)));class dt{static __wrap(e){e>>>=0;const t=Object.create(dt.prototype);return t.__wbg_ptr=e,gt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_establishedecies_free(e,0)}public_key(){const e=n.establishedecies_public_key(this.__wbg_ptr);return Ee.__wrap(e)}encrypt(e){let t,r;try{const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=n.establishedecies_encrypt(this.__wbg_ptr,i,s);return t=_[0],r=_[1],f(_[0],_[1])}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const _=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),c=o,a=n.establishedecies_decrypt(this.__wbg_ptr,_,c);var i=a[0],s=a[1];if(a[3])throw i=0,s=0,I(a[2]);return t=i,r=s,f(i,s)}finally{n.__wbindgen_free(t,r,1)}}check_code(){const e=n.establishedecies_check_code(this.__wbg_ptr);return fe.__wrap(e)}}const lt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_eventid_free(e>>>0,1)));class pt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_eventid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.eventid_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,lt.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.eventid_serverName(this.__wbg_ptr);return 0===e?void 0:Kr.__wrap(e)}toString(){let e,t;try{const r=n.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const yt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_identitykeys_free(e>>>0,1)));class wt{static __wrap(e){e>>>=0;const t=Object.create(wt.prototype);return t.__wbg_ptr=e,yt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_identitykeys_free(e,0)}get ed25519(){const e=n.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return et.__wrap(e)}set ed25519(e){K(e,et);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=n.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return Ee.__wrap(e)}set curve25519(e){K(e,Ee);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}}const ht="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_inboundcreationresult_free(e>>>0,1)));class ft{static __wrap(e){e>>>=0;const t=Object.create(ft.prototype);return t.__wbg_ptr=e,ht.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ht.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return dt.__wrap(e)}set channel(e){K(e,dt);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=n.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set message(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const bt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_inboundgroupsession_free(e>>>0,1)));class vt{static __wrap(e){e>>>=0;const t=Object.create(vt.prototype);return t.__wbg_ptr=e,bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=n.inboundgroupsession_roomId(this.__wbg_ptr);return cr.__wrap(e)}get senderKey(){const e=n.inboundgroupsession_senderKey(this.__wbg_ptr);return Ee.__wrap(e)}get sessionId(){let e,t;try{const r=n.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}hasBeenImported(){const e=n.inboundgroupsession_hasBeenImported(this.__wbg_ptr);return 0!==e}}const mt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysbackuprequest_free(e>>>0,1)));class kt{static __wrap(e){e>>>=0;const t=Object.create(kt.prototype);return t.__wbg_ptr=e,mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysbackuprequest_free(e,0)}get id(){const e=n.__wbg_get_keysbackuprequest_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_keysbackuprequest_body(this.__wbg_ptr);return e}get version(){const e=n.__wbg_get_keysbackuprequest_version(this.__wbg_ptr);return e}constructor(e,t,r){const i=n.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=i>>>0,mt.register(this,this.__wbg_ptr,this),this}get type(){const e=n.keysbackuprequest_type(this.__wbg_ptr);return e}}const St="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysclaimrequest_free(e>>>0,1)));class Rt{static __wrap(e){e>>>=0;const t=Object.create(Rt.prototype);return t.__wbg_ptr=e,St.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,St.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysclaimrequest_free(e,0)}get id(){const e=n.__wbg_get_keysclaimrequest_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_keysclaimrequest_body(this.__wbg_ptr);return e}constructor(e,t){const r=n.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,St.register(this,this.__wbg_ptr,this),this}get type(){const e=n.keysclaimrequest_type(this.__wbg_ptr);return e}}const It="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysqueryrequest_free(e>>>0,1)));class Kt{static __wrap(e){e>>>=0;const t=Object.create(Kt.prototype);return t.__wbg_ptr=e,It.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,It.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysqueryrequest_free(e,0)}get id(){const e=n.__wbg_get_keysqueryrequest_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_keysqueryrequest_body(this.__wbg_ptr);return e}constructor(e,t){const r=n.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,It.register(this,this.__wbg_ptr,this),this}get type(){const e=n.keysqueryrequest_type(this.__wbg_ptr);return e}}const Ct="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_keysuploadrequest_free(e>>>0,1)));class Et{static __wrap(e){e>>>=0;const t=Object.create(Et.prototype);return t.__wbg_ptr=e,Ct.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ct.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysuploadrequest_free(e,0)}get id(){const e=n.__wbg_get_keysuploadrequest_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_keysuploadrequest_body(this.__wbg_ptr);return e}constructor(e,t){const r=n.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Ct.register(this,this.__wbg_ptr,this),this}get type(){const e=n.keysuploadrequest_type(this.__wbg_ptr);return e}}const Dt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_maybesignature_free(e>>>0,1)));class Ot{static __wrap(e){e>>>=0;const t=Object.create(Ot.prototype);return t.__wbg_ptr=e,Dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_maybesignature_free(e,0)}isValid(){const e=n.maybesignature_isValid(this.__wbg_ptr);return 0!==e}isInvalid(){const e=n.maybesignature_isInvalid(this.__wbg_ptr);return 0!==e}get signature(){const e=n.maybesignature_signature(this.__wbg_ptr);return 0===e?void 0:Or.__wrap(e)}get invalidSignatureSource(){const e=n.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const Mt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_megolmdecryptionerror_free(e>>>0,1)));class qt{static __wrap(e){e>>>=0;const t=Object.create(qt.prototype);return t.__wbg_ptr=e,Mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Mt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmdecryptionerror_free(e,0)}get code(){const e=n.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr);return e}get description(){const e=n.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr);return e}get maybe_withheld(){const e=n.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr);return e}}const At="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_megolmv1backupkey_free(e>>>0,1)));class Bt{static __wrap(e){e>>>=0;const t=Object.create(Bt.prototype);return t.__wbg_ptr=e,At.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,At.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){const e=n.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr);return e}get algorithm(){const e=n.megolmv1backupkey_algorithm(this.__wbg_ptr);return e}}const Vt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_migration_free(e>>>0,1)));class Ut{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r){K(e,pe),K(r,Tr);const i=n.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr);return i}static migrateOlmSessions(e,t,r){const i=E(e,n.__wbindgen_malloc),s=o;K(r,Tr);const _=n.migration_migrateOlmSessions(i,s,t,r.__wbg_ptr);return _}static migrateMegolmSessions(e,t,r){const i=E(e,n.__wbindgen_malloc),s=o;K(r,Tr);const _=n.migration_migrateMegolmSessions(i,s,t,r.__wbg_ptr);return _}}const Ft="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_olmmachine_free(e>>>0,1)));class Tt{static __wrap(e){e>>>=0;const t=Object.create(Tt.prototype);return t.__wbg_ptr=e,Ft.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ft.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_olmmachine_free(e,0)}constructor(){const e=n.olmmachine_new();if(e[2])throw I(e[1]);return this.__wbg_ptr=e[0]>>>0,Ft.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,i){K(e,Jr),K(t,ze);var s=b(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o,c=b(i)?0:g(i,n.__wbindgen_malloc,n.__wbindgen_realloc),a=o;const u=n.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,s,_,c,a);return u}static initFromStore(e,t,r){K(e,Jr),K(t,ze),K(r,Tr);const i=n.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return i}get userId(){const e=n.olmmachine_userId(this.__wbg_ptr);return Jr.__wrap(e)}get deviceId(){const e=n.olmmachine_deviceId(this.__wbg_ptr);return ze.__wrap(e)}get deviceCreationTimeMs(){const e=n.olmmachine_deviceCreationTimeMs(this.__wbg_ptr);return e}get identityKeys(){const e=n.olmmachine_identityKeys(this.__wbg_ptr);return wt.__wrap(e)}get displayName(){const e=n.olmmachine_displayName(this.__wbg_ptr);return e}get roomKeyRequestsEnabled(){const e=n.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr);return 0!==e}set roomKeyRequestsEnabled(e){n.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){const e=n.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr);return 0!==e}set roomKeyForwardingEnabled(e){n.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=n.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}updateTrackedUsers(e){const t=E(e,n.__wbindgen_malloc),r=o,i=n.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r);return i}markAllTrackedUsersAsDirty(){const e=n.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr);return e}receiveSyncChanges(e,t,r,i){const s=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o;K(t,Ye);const c=n.olmmachine_receiveSyncChanges(this.__wbg_ptr,s,_,t.__wbg_ptr,r,b(i)?0:p(i));if(c[2])throw I(c[1]);return I(c[0])}outgoingRequests(){const e=n.olmmachine_outgoingRequests(this.__wbg_ptr);return e}markRequestAsSent(e,t,r){const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=o,a=n.olmmachine_markRequestAsSent(this.__wbg_ptr,i,s,t,_,c);if(a[2])throw I(a[1]);return I(a[0])}encryptRoomEvent(e,t,r){K(e,cr);const i=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=o,a=n.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,i,s,_,c);if(a[2])throw I(a[1]);return I(a[0])}decryptRoomEvent(e,t,r){const i=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;K(t,cr),K(r,qe);const _=n.olmmachine_decryptRoomEvent(this.__wbg_ptr,i,s,t.__wbg_ptr,r.__wbg_ptr);if(_[2])throw I(_[1]);return I(_[0])}getRoomEventEncryptionInfo(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o;K(t,cr);const s=n.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,i,t.__wbg_ptr);if(s[2])throw I(s[1]);return I(s[0])}crossSigningStatus(){const e=n.olmmachine_crossSigningStatus(this.__wbg_ptr);return e}exportSecretsBundle(){const e=n.olmmachine_exportSecretsBundle(this.__wbg_ptr);return e}importSecretsBundle(e){K(e,Rr);var t=e.__destroy_into_raw();const r=n.olmmachine_importSecretsBundle(this.__wbg_ptr,t);return r}exportCrossSigningKeys(){const e=n.olmmachine_exportCrossSigningKeys(this.__wbg_ptr);return e}importCrossSigningKeys(e,t,r){var i=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=b(t)?0:g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=o,a=b(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),u=o;const d=n.olmmachine_importCrossSigningKeys(this.__wbg_ptr,i,s,_,c,a,u);return d}bootstrapCrossSigning(e){const t=n.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e);return t}getIdentity(e){K(e,Jr);const t=n.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr);return t}sign(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.olmmachine_sign(this.__wbg_ptr,t,r);return i}invalidateGroupSession(e){K(e,cr);const t=n.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr);return t}shareRoomKey(e,t,r){K(e,cr);const i=E(t,n.__wbindgen_malloc),s=o;K(r,ut);const _=n.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,i,s,r.__wbg_ptr);return _}queryKeysForUsers(e){const t=E(e,n.__wbindgen_malloc),r=o,i=n.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return Kt.__wrap(i[0])}getMissingSessions(e){const t=E(e,n.__wbindgen_malloc),r=o,i=n.olmmachine_getMissingSessions(this.__wbg_ptr,t,r);return i}getUserDevices(e,t){K(e,Jr);const r=n.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!b(t),b(t)?0:t);return r}getDevice(e,t,r){K(e,Jr),K(t,ze);const i=n.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!b(r),b(r)?0:r);return i}getVerification(e,t){K(e,Jr);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,i);if(s[2])throw I(s[1]);return I(s[0])}getVerificationRequest(e,t){K(e,Jr);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,i);return 0===s?void 0:Yr.__wrap(s)}getVerificationRequests(e){K(e,Jr);const t=n.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr);return t}receiveVerificationEvent(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o;K(t,cr);const s=n.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,i,t.__wbg_ptr);if(s[2])throw I(s[1]);return I(s[0])}exportRoomKeys(e){const t=n.olmmachine_exportRoomKeys(this.__wbg_ptr,e);return t}importRoomKeys(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.olmmachine_importRoomKeys(this.__wbg_ptr,r,i,t);if(s[2])throw I(s[1]);return I(s[0])}importExportedRoomKeys(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,i,t);if(s[2])throw I(s[1]);return I(s[0])}importBackedUpRoomKeys(e,t,r){const i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o,_=n.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,b(t)?0:p(t),i,s);if(_[2])throw I(_[1]);return I(_[0])}saveBackupDecryptionKey(e,t){K(e,ce);const r=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=n.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,i);return s}getBackupKeys(){const e=n.olmmachine_getBackupKeys(this.__wbg_ptr);return e}verifyBackup(e){const t=n.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw I(t[1]);return I(t[0])}enableBackupV1(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o,c=n.olmmachine_enableBackupV1(this.__wbg_ptr,r,i,s,_);if(c[2])throw I(c[1]);return I(c[0])}isBackupEnabled(){const e=n.olmmachine_isBackupEnabled(this.__wbg_ptr);return e}disableBackup(){const e=n.olmmachine_disableBackup(this.__wbg_ptr);return e}backupRoomKeys(){const e=n.olmmachine_backupRoomKeys(this.__wbg_ptr);return e}roomKeyCounts(){const e=n.olmmachine_roomKeyCounts(this.__wbg_ptr);return e}static encryptExportedRoomKeys(e,t,r){let i,s;try{const a=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),u=o,d=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),l=o,p=n.olmmachine_encryptExportedRoomKeys(a,u,d,l,r);var _=p[0],c=p[1];if(p[3])throw _=0,c=0,I(p[2]);return i=_,s=c,f(_,c)}finally{n.__wbindgen_free(i,s,1)}}static decryptExportedRoomKeys(e,t){let r,i;try{const c=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),a=o,u=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),d=o,l=n.olmmachine_decryptExportedRoomKeys(c,a,u,d);var s=l[0],_=l[1];if(l[3])throw s=0,_=0,I(l[2]);return r=s,i=_,f(s,_)}finally{n.__wbindgen_free(r,i,1)}}registerRoomKeyUpdatedCallback(e){const t=n.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e);return t}registerRoomKeysWithheldCallback(e){const t=n.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e);return t}registerUserIdentityUpdatedCallback(e){const t=n.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e);return t}registerDevicesUpdatedCallback(e){const t=n.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e);return t}registerReceiveSecretCallback(e){const t=n.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e);return t}getSecretsFromInbox(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r);return i}deleteSecretsFromInbox(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r);return i}requestMissingSecretsIfNeeded(){const e=n.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr);return e}getRoomSettings(e){K(e,cr);const t=n.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr);return t}setRoomSettings(e,t){K(e,cr),K(t,vr);const r=n.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return r}dehydratedDevices(){const e=n.olmmachine_dehydratedDevices(this.__wbg_ptr);return Te.__wrap(e)}close(){const e=this.__destroy_into_raw();n.olmmachine_close(e)}}const Pt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_otheruseridentity_free(e>>>0,1)));class Nt{static __wrap(e){e>>>=0;const t=Object.create(Nt.prototype);return t.__wbg_ptr=e,Pt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_otheruseridentity_free(e,0)}isVerified(){const e=n.otheruseridentity_isVerified(this.__wbg_ptr);return 0!==e}verify(){const e=n.otheruseridentity_verify(this.__wbg_ptr);return e}requestVerification(e,t,r){K(e,cr),K(t,pt);var i=b(r)?0:E(r,n.__wbindgen_malloc),s=o;const _=n.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i,s);if(_[2])throw I(_[1]);return Yr.__wrap(_[0])}verificationRequestContent(e){let t,r;try{var i=b(e)?0:E(e,n.__wbindgen_malloc),s=o;const a=n.otheruseridentity_verificationRequestContent(this.__wbg_ptr,i,s);var _=a[0],c=a[1];if(a[3])throw _=0,c=0,I(a[2]);return t=_,r=c,f(_,c)}finally{n.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const o=n.otheruseridentity_masterKey(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,I(o[2]);return e=r,t=i,f(r,i)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const o=n.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,I(o[2]);return e=r,t=i,f(r,i)}finally{n.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){const e=n.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr);return e}identityNeedsUserApproval(){const e=n.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr);return 0!==e}wasPreviouslyVerified(){const e=n.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr);return 0!==e}withdrawVerification(){const e=n.otheruseridentity_withdrawVerification(this.__wbg_ptr);return e}hasVerificationViolation(){const e=n.otheruseridentity_hasVerificationViolation(this.__wbg_ptr);return 0!==e}}const xt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_outboundcreationresult_free(e>>>0,1)));class zt{static __wrap(e){e>>>=0;const t=Object.create(zt.prototype);return t.__wbg_ptr=e,xt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return dt.__wrap(e)}set channel(e){K(e,dt);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=n.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set initial_message(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const jt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_ownuseridentity_free(e>>>0,1)));class Lt{static __wrap(e){e>>>=0;const t=Object.create(Lt.prototype);return t.__wbg_ptr=e,jt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ownuseridentity_free(e,0)}isVerified(){const e=n.ownuseridentity_isVerified(this.__wbg_ptr);return 0!==e}verify(){const e=n.ownuseridentity_verify(this.__wbg_ptr);return e}requestVerification(e){var t=b(e)?0:E(e,n.__wbindgen_malloc),r=o;const i=n.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return I(i[0])}trustsOurOwnDevice(){const e=n.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr);return e}get masterKey(){let e,t;try{const o=n.ownuseridentity_masterKey(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,I(o[2]);return e=r,t=i,f(r,i)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const o=n.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,I(o[2]);return e=r,t=i,f(r,i)}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const o=n.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=o[0],i=o[1];if(o[3])throw r=0,i=0,I(o[2]);return e=r,t=i,f(r,i)}finally{n.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){const e=n.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr);return 0!==e}withdrawVerification(){const e=n.ownuseridentity_withdrawVerification(this.__wbg_ptr);return e}hasVerificationViolation(){const e=n.ownuseridentity_hasVerificationViolation(this.__wbg_ptr);return 0!==e}}const Wt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_pickledinboundgroupsession_free(e>>>0,1)));class Gt{static __unwrap(e){return e instanceof Gt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=n.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}set senderSigningKey(e){var t=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=n.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return 0===e?void 0:cr.__wrap(e)}set roomId(e){let t=0;b(e)||(K(e,cr),t=e.__destroy_into_raw()),n.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){const e=n.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr);return 0!==e}set imported(e){n.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){const e=n.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr);return 0!==e}set backedUp(e){n.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=n.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,Wt.register(this,this.__wbg_ptr,this),this}}const Qt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_pickledsession_free(e>>>0,1)));class Jt{static __unwrap(e){return e instanceof Jt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){const e=n.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr);return 0!==e}set createdUsingFallbackKey(e){n.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){const e=n.__wbg_get_pickledsession_creationTime(this.__wbg_ptr);return e}set creationTime(e){n.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){const e=n.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr);return e}set lastUseTime(e){n.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=n.pickledsession_new();return this.__wbg_ptr=e>>>0,Qt.register(this,this.__wbg_ptr,this),this}}const Ht="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_putdehydrateddevicerequest_free(e>>>0,1)));class Yt{static __wrap(e){e>>>=0;const t=Object.create(Yt.prototype);return t.__wbg_ptr=e,Ht.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ht.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){const e=n.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr);return e}constructor(e){const t=n.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,Ht.register(this,this.__wbg_ptr,this),this}}const Xt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qr_free(e>>>0,1)));class $t{static __wrap(e){e>>>=0;const t=Object.create($t.prototype);return t.__wbg_ptr=e,Xt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qr_free(e,0)}state(){const e=n.qr_state(this.__wbg_ptr);return e}hasBeenScanned(){const e=n.qr_hasBeenScanned(this.__wbg_ptr);return 0!==e}hasBeenConfirmed(){const e=n.qr_hasBeenConfirmed(this.__wbg_ptr);return 0!==e}get userId(){const e=n.qr_userId(this.__wbg_ptr);return Jr.__wrap(e)}get otherUserId(){const e=n.qr_otherUserId(this.__wbg_ptr);return Jr.__wrap(e)}get otherDeviceId(){const e=n.qr_otherDeviceId(this.__wbg_ptr);return ze.__wrap(e)}weStarted(){const e=n.qr_weStarted(this.__wbg_ptr);return 0!==e}cancelInfo(){const e=n.qr_cancelInfo(this.__wbg_ptr);return 0===e?void 0:we.__wrap(e)}isDone(){const e=n.qr_isDone(this.__wbg_ptr);return 0!==e}isCancelled(){const e=n.qr_isCancelled(this.__wbg_ptr);return 0!==e}isSelfVerification(){const e=n.qr_isSelfVerification(this.__wbg_ptr);return 0!==e}reciprocated(){const e=n.qr_reciprocated(this.__wbg_ptr);return 0!==e}get flowId(){let e,t;try{const r=n.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.qr_roomId(this.__wbg_ptr);return 0===e?void 0:cr.__wrap(e)}toQrCode(){const e=n.qr_toQrCode(this.__wbg_ptr);if(e[2])throw I(e[1]);return er.__wrap(e[0])}toBytes(){const e=n.qr_toBytes(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}reciprocate(){const e=n.qr_reciprocate(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}confirmScanning(){const e=n.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}cancel(){const e=n.qr_cancel(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}cancelWithCode(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.qr_cancelWithCode(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return I(i[0])}registerChangesCallback(e){n.qr_registerChangesCallback(this.__wbg_ptr,e)}}const Zt="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcode_free(e>>>0,1)));class er{static __wrap(e){e>>>=0;const t=Object.create(er.prototype);return t.__wbg_ptr=e,Zt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zt.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=n.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}}const tr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcodedata_free(e>>>0,1)));class rr{static __wrap(e){e>>>=0;const t=Object.create(rr.prototype);return t.__wbg_ptr=e,tr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,tr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){K(e,Ee);var i=e.__destroy_into_raw();const s=g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o;var c=b(r)?0:g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),a=o;const u=n.qrcodedata_new(i,s,_,c,a);if(u[2])throw I(u[1]);return this.__wbg_ptr=u[0]>>>0,tr.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=R(e,n.__wbindgen_malloc),r=o,i=n.qrcodedata_fromBytes(t,r);if(i[2])throw I(i[1]);return rr.__wrap(i[0])}toBytes(){const e=n.qrcodedata_toBytes(this.__wbg_ptr);var t=C(e[0],e[1]).slice();return n.__wbindgen_free(e[0],1*e[1],1),t}static fromBase64(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.qrcodedata_fromBase64(t,r);if(i[2])throw I(i[1]);return rr.__wrap(i[0])}toBase64(){let e,t;try{const r=n.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get publicKey(){const e=n.qrcodedata_publicKey(this.__wbg_ptr);return Ee.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=n.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.qrcodedata_serverName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}get mode(){const e=n.qrcodedata_mode(this.__wbg_ptr);return e}}const nr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_qrcodescan_free(e>>>0,1)));class ir{static __wrap(e){e>>>=0;const t=Object.create(ir.prototype);return t.__wbg_ptr=e,nr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,nr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=n.qrcodescan_fromBytes(e);if(t[2])throw I(t[1]);return ir.__wrap(t[0])}}const or="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_rehydrateddevice_free(e>>>0,1)));class sr{static __wrap(e){e>>>=0;const t=Object.create(sr.prototype);return t.__wbg_ptr=e,or.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,or.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.rehydrateddevice_receiveEvents(this.__wbg_ptr,t,r);return i}}const _r="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomid_free(e>>>0,1)));class cr{static __wrap(e){e>>>=0;const t=Object.create(cr.prototype);return t.__wbg_ptr=e,_r.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof cr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_r.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.roomid_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,_r.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const ar="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeycounts_free(e>>>0,1)));class ur{static __wrap(e){e>>>=0;const t=Object.create(ur.prototype);return t.__wbg_ptr=e,ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ar.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeycounts_free(e,0)}get total(){const e=n.__wbg_get_roomkeycounts_total(this.__wbg_ptr);return e}set total(e){n.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){const e=n.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr);return e}set backedUp(e){n.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}}const gr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeyimportresult_free(e>>>0,1)));class dr{static __wrap(e){e>>>=0;const t=Object.create(dr.prototype);return t.__wbg_ptr=e,gr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){const e=n.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr);return e>>>0}get totalCount(){const e=n.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr);return e>>>0}keys(){const e=n.roomkeyimportresult_keys(this.__wbg_ptr);return e}}const lr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeyinfo_free(e>>>0,1)));class pr{static __wrap(e){e>>>=0;const t=Object.create(pr.prototype);return t.__wbg_ptr=e,lr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyinfo_free(e,0)}get algorithm(){const e=n.roomkeyinfo_algorithm(this.__wbg_ptr);return e}get roomId(){const e=n.roomkeyinfo_roomId(this.__wbg_ptr);return cr.__wrap(e)}get senderKey(){const e=n.roomkeyinfo_senderKey(this.__wbg_ptr);return Ee.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const yr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomkeywithheldinfo_free(e>>>0,1)));class wr{static __wrap(e){e>>>=0;const t=Object.create(wr.prototype);return t.__wbg_ptr=e,yr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=n.roomkeywithheldinfo_sender(this.__wbg_ptr);return Jr.__wrap(e)}get algorithm(){const e=n.roomkeywithheldinfo_algorithm(this.__wbg_ptr);return e}get withheldCode(){let e,t;try{const r=n.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.roomkeywithheldinfo_roomId(this.__wbg_ptr);return cr.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const hr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roommessagerequest_free(e>>>0,1)));class fr{static __wrap(e){e>>>=0;const t=Object.create(fr.prototype);return t.__wbg_ptr=e,hr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,hr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roommessagerequest_free(e,0)}get id(){const e=n.__wbg_get_roommessagerequest_id(this.__wbg_ptr);return e}get room_id(){const e=n.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr);return e}get txn_id(){const e=n.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr);return e}get event_type(){const e=n.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_roommessagerequest_body(this.__wbg_ptr);return e}constructor(e,t,r,i,o){const s=n.roommessagerequest_new(e,t,r,i,o);return this.__wbg_ptr=s>>>0,hr.register(this,this.__wbg_ptr,this),this}get type(){const e=n.roommessagerequest_type(this.__wbg_ptr);return e}}const br="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_roomsettings_free(e>>>0,1)));class vr{static __wrap(e){e>>>=0;const t=Object.create(vr.prototype);return t.__wbg_ptr=e,br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,br.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomsettings_free(e,0)}get algorithm(){const e=n.__wbg_get_roomsettings_algorithm(this.__wbg_ptr);return e}set algorithm(e){n.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){const e=n.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr);return 0!==e}set onlyAllowTrustedDevices(e){n.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMs(e){n.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!b(e),b(e)?0:e)}get sessionRotationPeriodMessages(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMessages(e){n.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!b(e),b(e)?0:e)}constructor(){const e=n.roomsettings_new();return this.__wbg_ptr=e>>>0,br.register(this,this.__wbg_ptr,this),this}}const mr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_sas_free(e>>>0,1)));class kr{static __wrap(e){e>>>=0;const t=Object.create(kr.prototype);return t.__wbg_ptr=e,mr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_sas_free(e,0)}get userId(){const e=n.sas_userId(this.__wbg_ptr);return Jr.__wrap(e)}get deviceId(){const e=n.sas_deviceId(this.__wbg_ptr);return ze.__wrap(e)}get otherUserId(){const e=n.sas_otherUserId(this.__wbg_ptr);return Jr.__wrap(e)}get otherDeviceId(){const e=n.sas_otherDeviceId(this.__wbg_ptr);return ze.__wrap(e)}get flowId(){let e,t;try{const r=n.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.sas_roomId(this.__wbg_ptr);return 0===e?void 0:cr.__wrap(e)}supportsEmoji(){const e=n.sas_supportsEmoji(this.__wbg_ptr);return 0!==e}startedFromRequest(){const e=n.sas_startedFromRequest(this.__wbg_ptr);return 0!==e}isSelfVerification(){const e=n.sas_isSelfVerification(this.__wbg_ptr);return 0!==e}haveWeConfirmed(){const e=n.sas_haveWeConfirmed(this.__wbg_ptr);return 0!==e}hasBeenAccepted(){const e=n.sas_hasBeenAccepted(this.__wbg_ptr);return 0!==e}cancelInfo(){const e=n.sas_cancelInfo(this.__wbg_ptr);return 0===e?void 0:we.__wrap(e)}weStarted(){const e=n.sas_weStarted(this.__wbg_ptr);return 0!==e}accept(){const e=n.sas_accept(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}confirm(){const e=n.sas_confirm(this.__wbg_ptr);return e}cancel(){const e=n.sas_cancel(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}cancelWithCode(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.sas_cancelWithCode(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return I(i[0])}timedOut(){const e=n.sas_timedOut(this.__wbg_ptr);return 0!==e}canBePresented(){const e=n.sas_canBePresented(this.__wbg_ptr);return 0!==e}isDone(){const e=n.sas_isDone(this.__wbg_ptr);return 0!==e}isCancelled(){const e=n.sas_isCancelled(this.__wbg_ptr);return 0!==e}emoji(){const e=n.sas_emoji(this.__wbg_ptr);let t;return 0!==e[0]&&(t=D(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}emojiIndex(){const e=n.sas_emojiIndex(this.__wbg_ptr);let t;return 0!==e[0]&&(t=C(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}decimals(){const e=n.sas_decimals(this.__wbg_ptr);let t;return 0!==e[0]&&(t=q(e[0],e[1]).slice(),n.__wbindgen_free(e[0],2*e[1],2)),t}registerChangesCallback(e){n.sas_registerChangesCallback(this.__wbg_ptr,e)}}const Sr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_secretsbundle_free(e>>>0,1)));class Rr{static __wrap(e){e>>>=0;const t=Object.create(Rr.prototype);return t.__wbg_ptr=e,Sr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Sr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=n.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=n.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=n.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get backupBundle(){const e=n.secretsbundle_backupBundle(this.__wbg_ptr);return 0===e?void 0:de.__wrap(e)}to_json(){const e=n.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}static from_json(e){const t=n.secretsbundle_from_json(e);if(t[2])throw I(t[1]);return Rr.__wrap(t[0])}}const Ir="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_servername_free(e>>>0,1)));class Kr{static __wrap(e){e>>>=0;const t=Object.create(Kr.prototype);return t.__wbg_ptr=e,Ir.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ir.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_servername_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.servername_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,Ir.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=n.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get port(){const e=n.servername_port(this.__wbg_ptr);return 16777215===e?void 0:e}isIpLiteral(){const e=n.servername_isIpLiteral(this.__wbg_ptr);return 0!==e}}const Cr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_shieldstate_free(e>>>0,1)));class Er{static __wrap(e){e>>>=0;const t=Object.create(Er.prototype);return t.__wbg_ptr=e,Cr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Cr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_shieldstate_free(e,0)}get color(){const e=n.__wbg_get_shieldstate_color(this.__wbg_ptr);return e}set color(e){n.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=n.__wbg_get_shieldstate_code(this.__wbg_ptr);return 6===e?void 0:e}set code(e){n.__wbg_set_shieldstate_code(this.__wbg_ptr,b(e)?6:e)}get message(){const e=n.shieldstate_message(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),n.__wbindgen_free(e[0],1*e[1],1)),t}}const Dr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signature_free(e>>>0,1)));class Or{static __wrap(e){e>>>=0;const t=Object.create(Or.prototype);return t.__wbg_ptr=e,Dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signature_free(e,0)}get ed25519(){const e=n.signature_ed25519(this.__wbg_ptr);return 0===e?void 0:rt.__wrap(e)}toBase64(){let e,t;try{const r=n.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}}const Mr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatureuploadrequest_free(e>>>0,1)));class qr{static __wrap(e){e>>>=0;const t=Object.create(qr.prototype);return t.__wbg_ptr=e,Mr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Mr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureuploadrequest_free(e,0)}get id(){const e=n.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr);return e}constructor(e,t){const r=n.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Mr.register(this,this.__wbg_ptr,this),this}get type(){const e=n.signatureuploadrequest_type(this.__wbg_ptr);return e}}const Ar="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatureverification_free(e>>>0,1)));class Br{static __wrap(e){e>>>=0;const t=Object.create(Br.prototype);return t.__wbg_ptr=e,Ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ar.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureverification_free(e,0)}get deviceState(){const e=n.signatureverification_deviceState(this.__wbg_ptr);return e}get userState(){const e=n.signatureverification_userState(this.__wbg_ptr);return e}trusted(){const e=n.signatureverification_trusted(this.__wbg_ptr);return 0!==e}}const Vr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_signatures_free(e>>>0,1)));class Ur{static __wrap(e){e>>>=0;const t=Object.create(Ur.prototype);return t.__wbg_ptr=e,Vr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatures_free(e,0)}constructor(){const e=n.signatures_new();return this.__wbg_ptr=e>>>0,Vr.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){K(e,Jr),K(t,Je),K(r,rt);const i=n.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return 0===i?void 0:Ot.__wrap(i)}getSignature(e,t){K(e,Jr),K(t,Je);const r=n.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return 0===r?void 0:rt.__wrap(r)}get(e){K(e,Jr);const t=n.signatures_get(this.__wbg_ptr,e.__wbg_ptr);return t}clear(){n.signatures_clear(this.__wbg_ptr)}isEmpty(){const e=n.signatures_isEmpty(this.__wbg_ptr);return 0!==e}get count(){const e=n.signatures_count(this.__wbg_ptr);return e>>>0}asJSON(){const e=n.signatures_asJSON(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}}const Fr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_storehandle_free(e>>>0,1)));class Tr{static __wrap(e){e>>>=0;const t=Object.create(Tr.prototype);return t.__wbg_ptr=e,Fr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storehandle_free(e,0)}static open(e,t){var r=b(e)?0:g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=b(t)?0:g(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o;const c=n.storehandle_open(r,i,s,_);return c}static openWithKey(e,t){const r=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),i=o,s=R(t,n.__wbindgen_malloc),_=o,c=n.storehandle_openWithKey(r,i,s,_);return c}}const Pr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_todevicerequest_free(e>>>0,1)));class Nr{static __wrap(e){e>>>=0;const t=Object.create(Nr.prototype);return t.__wbg_ptr=e,Pr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todevicerequest_free(e,0)}get id(){const e=n.__wbg_get_todevicerequest_id(this.__wbg_ptr);return e}get event_type(){const e=n.__wbg_get_todevicerequest_event_type(this.__wbg_ptr);return e}get txn_id(){const e=n.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr);return e}get body(){const e=n.__wbg_get_todevicerequest_body(this.__wbg_ptr);return e}constructor(e,t,r,i){const o=n.todevicerequest_new(e,t,r,i);return this.__wbg_ptr=o>>>0,Pr.register(this,this.__wbg_ptr,this),this}get type(){const e=n.todevicerequest_type(this.__wbg_ptr);return e}}const xr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_tracing_free(e>>>0,1)));class zr{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_tracing_free(e,0)}static isAvailable(){const e=n.tracing_isAvailable();return 0!==e}constructor(e){const t=n.tracing_new(e);if(t[2])throw I(t[1]);return this.__wbg_ptr=t[0]>>>0,xr.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=n.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw I(t[0])}turnOn(){const e=n.tracing_turnOn(this.__wbg_ptr);if(e[1])throw I(e[0])}turnOff(){const e=n.tracing_turnOff(this.__wbg_ptr);if(e[1])throw I(e[0])}}const jr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_uploadsigningkeysrequest_free(e>>>0,1)));class Lr{static __wrap(e){e>>>=0;const t=Object.create(Lr.prototype);return t.__wbg_ptr=e,jr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){const e=n.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr);return e}constructor(e){const t=n.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,jr.register(this,this.__wbg_ptr,this),this}}const Wr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_userdevices_free(e>>>0,1)));class Gr{static __wrap(e){e>>>=0;const t=Object.create(Gr.prototype);return t.__wbg_ptr=e,Wr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userdevices_free(e,0)}get(e){K(e,ze);const t=n.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return 0===t?void 0:Ne.__wrap(t)}isAnyVerified(){const e=n.userdevices_isAnyVerified(this.__wbg_ptr);return 0!==e}keys(){const e=n.userdevices_keys(this.__wbg_ptr);return e}devices(){const e=n.userdevices_devices(this.__wbg_ptr);return e}}const Qr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_userid_free(e>>>0,1)));class Jr{static __wrap(e){e>>>=0;const t=Object.create(Jr.prototype);return t.__wbg_ptr=e,Qr.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof Jr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userid_free(e,0)}constructor(e){const t=g(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=o,i=n.userid_new(t,r);if(i[2])throw I(i[1]);return this.__wbg_ptr=i[0]>>>0,Qr.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.userid_serverName(this.__wbg_ptr);return Kr.__wrap(e)}isHistorical(){const e=n.userid_isHistorical(this.__wbg_ptr);return 0!==e}toString(){let e,t;try{const r=n.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}clone(){const e=n.userid_clone(this.__wbg_ptr);return Jr.__wrap(e)}}const Hr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_verificationrequest_free(e>>>0,1)));class Yr{static __wrap(e){e>>>=0;const t=Object.create(Yr.prototype);return t.__wbg_ptr=e,Hr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_verificationrequest_free(e,0)}static request(e,t,r,i){let s,_;try{K(e,Jr),K(t,ze),K(r,Jr);var c=b(i)?0:E(i,n.__wbindgen_malloc),a=o;const d=n.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,c,a);var u=d[0],g=d[1];if(d[3])throw u=0,g=0,I(d[2]);return s=u,_=g,f(u,g)}finally{n.__wbindgen_free(s,_,1)}}get ownUserId(){const e=n.verificationrequest_ownUserId(this.__wbg_ptr);return Jr.__wrap(e)}get otherUserId(){const e=n.verificationrequest_otherUserId(this.__wbg_ptr);return Jr.__wrap(e)}get otherDeviceId(){const e=n.verificationrequest_otherDeviceId(this.__wbg_ptr);return 0===e?void 0:ze.__wrap(e)}get roomId(){const e=n.verificationrequest_roomId(this.__wbg_ptr);return 0===e?void 0:cr.__wrap(e)}get cancelInfo(){const e=n.verificationrequest_cancelInfo(this.__wbg_ptr);return 0===e?void 0:we.__wrap(e)}isPassive(){const e=n.verificationrequest_isPassive(this.__wbg_ptr);return 0!==e}isReady(){const e=n.verificationrequest_isReady(this.__wbg_ptr);return 0!==e}timedOut(){const e=n.verificationrequest_timedOut(this.__wbg_ptr);return 0!==e}timeRemainingMillis(){const e=n.verificationrequest_timeRemainingMillis(this.__wbg_ptr);return e}get theirSupportedMethods(){const e=n.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw I(e[2]);let t;return 0!==e[0]&&(t=D(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}get ourSupportedMethods(){const e=n.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw I(e[2]);let t;return 0!==e[0]&&(t=D(e[0],e[1]).slice(),n.__wbindgen_free(e[0],4*e[1],4)),t}get flowId(){let e,t;try{const r=n.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}isSelfVerification(){const e=n.verificationrequest_isSelfVerification(this.__wbg_ptr);return 0!==e}weStarted(){const e=n.verificationrequest_weStarted(this.__wbg_ptr);return 0!==e}isDone(){const e=n.verificationrequest_isDone(this.__wbg_ptr);return 0!==e}phase(){const e=n.verificationrequest_phase(this.__wbg_ptr);return e}getVerification(){const e=n.verificationrequest_getVerification(this.__wbg_ptr);return e}registerChangesCallback(e){n.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){const e=n.verificationrequest_isCancelled(this.__wbg_ptr);return 0!==e}acceptWithMethods(e){const t=E(e,n.__wbindgen_malloc),r=o,i=n.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(i[2])throw I(i[1]);return I(i[0])}accept(){const e=n.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}cancel(){const e=n.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw I(e[1]);return I(e[0])}startSas(){const e=n.verificationrequest_startSas(this.__wbg_ptr);return e}generateQrCode(){const e=n.verificationrequest_generateQrCode(this.__wbg_ptr);return e}scanQrCode(e){K(e,ir);const t=n.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr);return t}}const Xr="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>n.__wbg_versions_free(e>>>0,1)));class $r{static __wrap(e){e>>>=0;const t=Object.create($r.prototype);return t.__wbg_ptr=e,Xr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xr.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_versions_free(e,0)}get vodozemac(){const e=n.__wbg_get_versions_vodozemac(this.__wbg_ptr);return e}get matrix_sdk_crypto(){const e=n.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr);return e}get git_sha(){const e=n.__wbg_get_versions_git_sha(this.__wbg_ptr);return e}get git_description(){const e=n.__wbg_get_versions_git_description(this.__wbg_ptr);return e}}function Zr(e,t){const r=String(t),i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function en(e,t){const r=String(t),i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function tn(e){const t=e.Window;return t}function rn(e){const t=e.WorkerGlobalScope;return t}function nn(e,t){const r=e.add(t);return r}function on(){return y((function(e,t,r){const n=e.add(t,r);return n}),arguments)}function sn(e,t){const r=e.at(t);return r}function _n(e){const t=ue.__wrap(e);return t}function cn(){return y((function(e,t,r,n){const i=IDBKeyRange.bound(e,t,0!==r,0!==n);return i}),arguments)}function an(){return y((function(e,t){const r=IDBKeyRange.bound(e,t);return r}),arguments)}function un(e){const t=e.buffer;return t}function gn(){return y((function(e,t,r,n){const i=e.call(t,r,n);return i}),arguments)}function dn(){return y((function(e,t,r){const n=e.call(t,r);return n}),arguments)}function ln(){return y((function(e,t,r,n,i){const o=e.call(t,r,n,i);return o}),arguments)}function pn(){return y((function(e,t){const r=e.call(t);return r}),arguments)}function yn(e){const t=clearTimeout(e);return t}function wn(){return y((function(e){const t=e.clear();return t}),arguments)}function hn(e){e.close()}function fn(e){const t=e.code;return t}function bn(){return y((function(e){e.continue()}),arguments)}function vn(){return y((function(e){const t=e.count();return t}),arguments)}function mn(){return y((function(e){const t=e.count();return t}),arguments)}function kn(){return y((function(e,t,r,n){const i=e.createIndex(f(t,r),n);return i}),arguments)}function Sn(){return y((function(e,t,r,n,i){const o=e.createIndex(f(t,r),n,i);return o}),arguments)}function Rn(){return y((function(e,t,r){const n=e.createObjectStore(f(t,r));return n}),arguments)}function In(e){const t=ke.__wrap(e);return t}function Kn(e){const t=Re.__wrap(e);return t}function Cn(e){const t=Ke.__wrap(e);return t}function En(e){const t=e.crypto;return t}function Dn(e){console.debug(e)}function On(e,t){e.debug(t)}function Mn(e){const t=Oe.__wrap(e);return t}function qn(e){const t=Be.__wrap(e);return t}function An(e){const t=Ue.__wrap(e);return t}function Bn(){return y((function(e,t,r){e.deleteObjectStore(f(t,r))}),arguments)}function Vn(){return y((function(e,t){const r=e.delete(t);return r}),arguments)}function Un(){return y((function(e){const t=e.delete();return t}),arguments)}function Fn(e){const t=Ne.__wrap(e);return t}function Tn(e){const t=ze.__wrap(e);return t}function Pn(e){const t=Le.__wrap(e);return t}function Nn(e){const t=Je.__wrap(e);return t}function xn(e){const t=e.done;return t}function zn(e){const t=it.__wrap(e);return t}function jn(e){const t=ct.__wrap(e);return t}function Ln(e){const t=Object.entries(e);return t}function Wn(e){const t=e.entries();return t}function Gn(e,t){e.error(t)}function Qn(e,t){let r,i;try{r=e,i=t,console.error(f(e,t))}finally{n.__wbindgen_free(r,i,1)}}function Jn(){return y((function(e){const t=e.error;return b(t)?0:p(t)}),arguments)}function Hn(e){console.error(e)}function Yn(e){const t=Array.from(e);return t}function Xn(){return y((function(e){const t=e.getAllKeys();return t}),arguments)}function $n(){return y((function(e){const t=e.getAll();return t}),arguments)}function Zn(){return y((function(e,t){const r=e.getAll(t);return r}),arguments)}function ei(){return y((function(e,t,r){const n=e.getAll(t,r>>>0);return n}),arguments)}function ti(){return y((function(e,t){e.getRandomValues(t)}),arguments)}function ri(e){const t=e.getTime();return t}function ni(){return y((function(e,t){const r=e.get(t);return r}),arguments)}function ii(){return y((function(e,t){const r=e.get(t);return r}),arguments)}function oi(e,t){const r=e[t>>>0];return r}function si(){return y((function(e,t){const r=Reflect.get(e,t);return r}),arguments)}function _i(e,t){const r=e[t];return r}function ci(e,t){const r=e[t];return r}function ai(e){const t=e.global;return t}function ui(e){const t=vt.__wrap(e);return t}function gi(){return y((function(e,t,r){const n=e.index(f(t,r));return n}),arguments)}function di(){return y((function(e){const t=e.indexedDB;return b(t)?0:p(t)}),arguments)}function li(){return y((function(e){const t=e.indexedDB;return b(t)?0:p(t)}),arguments)}function pi(){return y((function(e){const t=e.indexedDB;return b(t)?0:p(t)}),arguments)}function yi(e){console.info(e)}function wi(e,t){e.info(t)}function hi(e){let t;try{t=e instanceof ArrayBuffer}catch(n){t=!1}const r=t;return r}function fi(e){let t;try{t=e instanceof Map}catch(n){t=!1}const r=t;return r}function bi(e){let t;try{t=e instanceof Promise}catch(n){t=!1}const r=t;return r}function vi(e){let t;try{t=e instanceof Uint8Array}catch(n){t=!1}const r=t;return r}function mi(e){const t=Array.isArray(e);return t}function ki(e){const t=Number.isSafeInteger(e);return t}function Si(e,t,r){const i=t.item(r>>>0);var s=b(i)?0:g(i,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o;l().setInt32(e+4,_,!0),l().setInt32(e+0,s,!0)}function Ri(){const e=Symbol.iterator;return e}function Ii(){return y((function(e){const t=e.key;return t}),arguments)}function Ki(e){const t=kt.__wrap(e);return t}function Ci(e){const t=Rt.__wrap(e);return t}function Ei(e){const t=Kt.__wrap(e);return t}function Di(e){const t=Et.__wrap(e);return t}function Oi(e){const t=e.length;return t}function Mi(e){const t=e.length;return t}function qi(e){const t=e.length;return t}function Ai(){return y((function(e,t){const r=IDBKeyRange.lowerBound(e,0!==t);return r}),arguments)}function Bi(e){const t=Ot.__wrap(e);return t}function Vi(e){const t=qt.__wrap(e);return t}function Ui(e,t){const r=t.message,i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function Fi(e){const t=e.msCrypto;return t}function Ti(e,t){const r=t.name,i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function Pi(e){const t=new Set(e);return t}function Ni(){const e=new Array;return e}function xi(e,t){try{var r={a:e,b:t},n=(e,t)=>{const n=r.a;r.a=0;try{return N(n,r.b,e,t)}finally{r.a=n}};const i=new Promise(n);return i}finally{r.a=r.b=0}}function zi(e){const t=new Uint8Array(e);return t}function ji(e){const t=new Date(e);return t}function Li(){const e=new Object;return e}function Wi(){const e=new Error;return e}function Gi(e){const t=new Uint8ClampedArray(e);return t}function Qi(){const e=new Map;return e}function Ji(e,t){const r=new Function(f(e,t));return r}function Hi(e,t,r){const n=new Uint8Array(e,t>>>0,r>>>0);return n}function Yi(e,t,r){const n=new Uint8ClampedArray(e,t>>>0,r>>>0);return n}function Xi(e){const t=new Uint8ClampedArray(e>>>0);return t}function $i(e){const t=new Uint8Array(e>>>0);return t}function Zi(){return y((function(e,t){const r=new DOMException(f(e,t));return r}),arguments)}function eo(){return y((function(e){const t=e.next();return t}),arguments)}function to(e){const t=e.next;return t}function ro(e){const t=e.node;return t}function no(e){const t=e.now();return t}function io(){const e=Date.now();return e}function oo(e){const t=e.objectStoreNames;return t}function so(){return y((function(e,t,r){const n=e.objectStore(f(t,r));return n}),arguments)}function _o(e){const t=e.oldVersion;return t}function co(e){const t=Tt.__wrap(e);return t}function ao(){return y((function(e){const t=e.openCursor();return t}),arguments)}function uo(){return y((function(e,t){const r=e.openCursor(t);return r}),arguments)}function go(){return y((function(e){const t=e.openCursor();return t}),arguments)}function lo(){return y((function(e,t,r){const n=e.open(f(t,r));return n}),arguments)}function po(){return y((function(e,t,r,n){const i=e.open(f(t,r),n>>>0);return i}),arguments)}function yo(e){const t=Nt.__wrap(e);return t}function wo(e){const t=Lt.__wrap(e);return t}function ho(){return y((function(e,t){const r=JSON.parse(f(e,t));return r}),arguments)}function fo(e){const t=e.performance;return t}function bo(e){const t=Gt.__unwrap(e);return t}function vo(e){const t=Jt.__unwrap(e);return t}function mo(e){const t=e.process;return t}function ko(e,t){const r=e.push(t);return r}function So(){return y((function(e,t,r){const n=e.put(t,r);return n}),arguments)}function Ro(e){const t=Yt.__wrap(e);return t}function Io(e){const t=$t.__wrap(e);return t}function Ko(e){queueMicrotask(e)}function Co(e){const t=e.queueMicrotask;return t}function Eo(){return y((function(e,t){e.randomFillSync(t)}),arguments)}function Do(e){const t=e.readyState;return(ne.indexOf(t)+1||3)-1}function Oo(e){const t=sr.__wrap(e);return t}function Mo(){return y((function(){const t=e.require;return t}),arguments)}function qo(e){const t=Promise.resolve(e);return t}function Ao(){return y((function(e){const t=e.result;return t}),arguments)}function Bo(e){const t=cr.__unwrap(e);return t}function Vo(e){const t=ur.__wrap(e);return t}function Uo(e){const t=dr.__wrap(e);return t}function Fo(e){const t=pr.__wrap(e);return t}function To(e){const t=wr.__wrap(e);return t}function Po(e){const t=fr.__wrap(e);return t}function No(e){const t=vr.__wrap(e);return t}function xo(e){const t=kr.__wrap(e);return t}function zo(e){const t=Rr.__wrap(e);return t}function jo(){return y((function(e,t){const r=setTimeout(e,t);return r}),arguments)}function Lo(e,t,r){e[t>>>0]=r}function Wo(e,t,r){e.set(t,r>>>0)}function Go(e,t,r){e[t]=r}function Qo(e,t,r){e[t]=r}function Jo(e,t,r){const n=e.set(t,r);return n}function Ho(e,t,r){e.set(t,r>>>0)}function Yo(e,t){e.onabort=t}function Xo(e,t){e.onblocked=t}function $o(e,t){e.oncomplete=t}function Zo(e,t){e.onerror=t}function es(e,t){e.onerror=t}function ts(e,t){e.onsuccess=t}function rs(e,t){e.onupgradeneeded=t}function ns(e,t){e.onversionchange=t}function is(e,t){e.unique=0!==t}function os(e){const t=Ur.__wrap(e);return t}function ss(e){const t=qr.__wrap(e);return t}function _s(e){const t=Br.__wrap(e);return t}function cs(e,t){const r=t.stack,i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function as(){const e="undefined"===typeof r.g?null:r.g;return b(e)?0:p(e)}function us(){const e="undefined"===typeof globalThis?null:globalThis;return b(e)?0:p(e)}function gs(){const e="undefined"===typeof self?null:self;return b(e)?0:p(e)}function ds(){const e="undefined"===typeof window?null:window;return b(e)?0:p(e)}function ls(e){const t=Tr.__wrap(e);return t}function ps(){return y((function(e){const t=JSON.stringify(e);return t}),arguments)}function ys(e,t,r){const n=e.subarray(t>>>0,r>>>0);return n}function ws(e){const t=e.target;return b(t)?0:p(t)}function hs(e,t){const r=e.then(t);return r}function fs(e,t,r){const n=e.then(t,r);return n}function bs(e){const t=Nr.__wrap(e);return t}function vs(){return y((function(e,t,r,n){const i=e.transaction(f(t,r),ie[n]);return i}),arguments)}function ms(e){const t=e.transaction;return b(t)?0:p(t)}function ks(){return y((function(e,t,r){const n=e.transaction(t,ie[r]);return n}),arguments)}function Ss(){return y((function(e,t){const r=e.update(t);return r}),arguments)}function Rs(e){const t=Gr.__wrap(e);return t}function Is(e){const t=Jr.__wrap(e);return t}function Ks(e){const t=Jr.__unwrap(e);return t}function Cs(){return y((function(e){const t=e.value;return t}),arguments)}function Es(e){const t=e.value;return t}function Ds(e){const t=e.values();return t}function Os(e){const t=Yr.__wrap(e);return t}function Ms(e){const t=e.version;return t}function qs(e){const t=e.versions;return t}function As(e){console.warn(e)}function Bs(e,t){e.warn(t)}function Vs(e){const t=+e;return t}function Us(e){const t=e;return t}function Fs(e){const t=BigInt.asUintN(64,e);return t}function Ts(e,t){const r=t,n="bigint"===typeof r?r:void 0;l().setBigInt64(e+8,b(n)?BigInt(0):n,!0),l().setInt32(e+0,!b(n),!0)}function Ps(e){const t=e,r="boolean"===typeof t?t?1:0:2;return r}function Ns(e){const t=e.original;if(1==t.cnt--)return t.a=0,!0;const r=!1;return r}function xs(e,t,r){const n=m(e,t,30,V);return n}function zs(e,t,r){const n=m(e,t,410,U);return n}function js(e,t,r){const n=m(e,t,410,F);return n}function Ls(e,t,r){const n=k(e,t,416,T);return n}function Ws(e,t,r){const n=k(e,t,416,P);return n}function Gs(e,t){const r=S(t),i=g(r,n.__wbindgen_malloc,n.__wbindgen_realloc),s=o;l().setInt32(e+4,s,!0),l().setInt32(e+0,i,!0)}function Qs(e,t){const r=new Error(f(e,t));return r}function Js(e,t){const r=e in t;return r}function Hs(){const e=n.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)}function Ys(e){const t=Array.isArray(e);return t}function Xs(e){const t="bigint"===typeof e;return t}function $s(e){const t="function"===typeof e;return t}function Zs(e){const t=null===e;return t}function e_(e){const t=e,r="object"===typeof t&&null!==t;return r}function t_(e){const t="string"===typeof e;return t}function r_(e){const t=void 0===e;return t}function n_(e,t){const r=e===t;return r}function i_(e,t){const r=e==t;return r}function o_(){const e=n.memory;return e}function s_(e,t){const r=t,n="number"===typeof r?r:void 0;l().setFloat64(e+8,b(n)?0:n,!0),l().setInt32(e+0,!b(n),!0)}function __(e){const t=e;return t}function c_(e,t){const r=t,i="string"===typeof r?r:void 0;var s=b(i)?0:g(i,n.__wbindgen_malloc,n.__wbindgen_realloc),_=o;l().setInt32(e+4,_,!0),l().setInt32(e+0,s,!0)}function a_(e,t){const r=f(e,t);return r}function u_(e,t){throw new Error(f(e,t))}function g_(e){let t;try{t=+e}catch(n){t=n}const r=t;return r}},7904:function(e,t,r){r.r(t),r.d(t,{initRustCrypto:function(){return Ge}});r(4114),r(8111),r(2489),r(7588);var n=r(4761),i=r(698),o=(r(4603),r(7566),r(8721),r(3430));const s=new URL(r(9627),r.b);o.__wbg_set_wasm(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let _=null;async function c(){const{instance:e}=await WebAssembly.instantiateStreaming(fetch(s),{"./matrix_sdk_crypto_wasm_bg.js":o});o.__wbg_set_wasm(e.exports),e.exports.__wbindgen_start()}async function a(){_||(_=c()),await _}r(6573),r(8100),r(7936),r(116),r(1701),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(7467),r(4732),r(9577);var u=r(2696),g=r(3877),d=r(3178),l=r(1366),p=r(3271),y=r(9683),w=r(5629),h=r(3232),f=r(6170),b=r(4864);class v{constructor(e,t,r,i,s){this.olmMachine=e,this.keyClaimManager=t,this.outgoingRequestManager=r,this.room=i,this.encryptionSettings=s,(0,n.A)(this,"prefixedLogger",void 0),(0,n.A)(this,"lazyLoadedMembersResolved",!1),(0,n.A)(this,"currentEncryptionPromise",Promise.resolve()),this.prefixedLogger=p.v.getChild("[".concat(i.roomId," encryption]"));var _=i.getJoinedMembers();this.olmMachine.updateTrackedUsers(_.map((e=>new o.UserId(e.userId)))).catch((e=>this.prefixedLogger.error("Error initializing tracked users",e)))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==g.O.Join||e.membership==g.O.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new o.UserId(e.userId)]).catch((e=>{this.prefixedLogger.error("Unable to update tracked users",e)}))}prepareForEncryption(e,t){var r=this;return(0,i.A)((function*(){yield r.encryptEvent(null,e,t)}))()}encryptEvent(e,t,r){var n,o=this,s=new p.T(this.prefixedLogger,e?null!==(n=e.getTxnId())&&void 0!==n?n:"":"prepareForEncryption"),_=this.currentEncryptionPromise.catch((()=>{})).then((0,i.A)((function*(){yield(0,f.NQ)(s,"ensureEncryptionSession",(0,i.A)((function*(){yield o.ensureEncryptionSession(s,t,r)}))),e&&(yield(0,f.NQ)(s,"encryptEventInner",(0,i.A)((function*(){yield o.encryptEventInner(s,e)}))))})));return this.currentEncryptionPromise=_,_}ensureEncryptionSession(e,t,r){var n=this;return(0,i.A)((function*(){if("m.megolm.v1.aes-sha2"!==n.encryptionSettings.algorithm)throw new Error("Cannot encrypt in ".concat(n.room.roomId," for unsupported algorithm '").concat(n.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var s=yield n.room.getEncryptionTargetMembers();n.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),n.outgoingRequestManager.doProcessOutgoingRequests()):(yield(0,f.NQ)(n.prefixedLogger,"loadMembersIfNeeded: updateTrackedUsers",(0,i.A)((function*(){yield n.olmMachine.updateTrackedUsers(s.map((e=>new o.UserId(e.userId))))}))),e.debug("Updated tracked users"),n.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield(0,f.NQ)(n.prefixedLogger,"doProcessOutgoingRequests",(0,i.A)((function*(){yield n.outgoingRequestManager.doProcessOutgoingRequests()})))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(n.room.shouldEncryptForInvitedMembers(),"):"),s.map((e=>"".concat(e.userId," (").concat(e.membership,")"))));var _=s.map((e=>new o.UserId(e.userId)));yield(0,f.NQ)(n.prefixedLogger,"ensureSessionsForUsers",(0,i.A)((function*(){yield n.keyClaimManager.ensureSessionsForUsers(e,_)})));var c=new o.EncryptionSettings;switch(c.historyVisibility=m(n.room.getHistoryVisibility()),c.algorithm=o.EncryptionAlgorithm.MegolmV1AesSha2,"number"===typeof n.encryptionSettings.rotation_period_ms&&(c.rotationPeriod=BigInt(1e3*n.encryptionSettings.rotation_period_ms)),"number"===typeof n.encryptionSettings.rotation_period_msgs&&(c.rotationPeriodMessages=BigInt(n.encryptionSettings.rotation_period_msgs)),r.kind){case b.DeviceIsolationModeKind.AllDevicesIsolationMode:var a,u=null!==(a=n.room.getBlacklistUnverifiedDevices())&&void 0!==a?a:t;c.sharingStrategy=o.CollectStrategy.deviceBasedStrategy(u,r.errorOnVerifiedUserProblems);break;case b.DeviceIsolationModeKind.OnlySignedDevicesIsolationMode:c.sharingStrategy=o.CollectStrategy.identityBasedStrategy();break}yield(0,f.NQ)(n.prefixedLogger,"shareRoomKey",(0,i.A)((function*(){var e=yield n.olmMachine.shareRoomKey(new o.RoomId(n.room.roomId),_,c);if(e)for(var t of e)yield n.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(t)})))}))()}forceDiscardSession(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.invalidateGroupSession(new o.RoomId(e.room.roomId));t&&e.prefixedLogger.info("Discarded existing group session")}))()}encryptEventInner(e,t){var r=this;return(0,i.A)((function*(){e.debug("Encrypting actual message content");var n=yield r.olmMachine.encryptRoomEvent(new o.RoomId(r.room.roomId),t.getType(),JSON.stringify(t.getContent()));t.makeEncrypted(w.Bx.RoomMessageEncrypted,JSON.parse(n),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")}))()}}function m(e){switch(e){case h.Jv.Invited:return o.HistoryVisibility.Invited;case h.Jv.Joined:return o.HistoryVisibility.Joined;case h.Jv.Shared:return o.HistoryVisibility.Shared;case h.Jv.WorldReadable:return o.HistoryVisibility.WorldReadable}}var k=r(944),S=r(2668),R="/_matrix/client/unstable/org.matrix.msc3814.v1",I="org.matrix.msc3814",K=6048e5;class C extends S.X{constructor(e,t,r,i,o){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=i,this.secretStorage=o,(0,n.A)(this,"intervalId",void 0)}cacheKey(e){var t=this;return(0,i.A)((function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(b.CryptoEvent.DehydrationKeyCached)}))()}isSupported(){var e=this;return(0,i.A)((function*(){try{yield e.http.authedRequest(y.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:R})}catch(r){var t=r;if("M_UNRECOGNIZED"===t.errcode)return!1;if("M_NOT_FOUND"===t.errcode)return!0;throw r}return!0}))()}start(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if("boolean"===typeof r&&(r={createNewKey:r}),!r.onlyIfKeyCached||(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey())){if(t.stop(),!1!==r.rehydrate)try{yield t.rehydrateDeviceIfAvailable()}catch(n){t.logger.info("dehydration: Error rehydrating device:",n),t.emit(b.CryptoEvent.RehydrationError,n.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}}))()}isKeyStored(){var e=this;return(0,i.A)((function*(){return Boolean(yield e.secretStorage.isStored(I))}))()}resetKey(){var e=this;return(0,i.A)((function*(){var t=o.DehydratedDeviceKey.createRandomKey();return yield e.secretStorage.store(I,t.toBase64()),yield e.cacheKey(t),t}))()}getKey(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var n=yield t.secretStorage.get(I);if(void 0===n)return e?yield t.resetKey():null;var i=(0,k.y4)(n);try{var s=o.DehydratedDeviceKey.createKeyFromArray(i);return yield t.cacheKey(s),s}finally{i.fill(0)}}))()}rehydrateDeviceIfAvailable(){var e=this;return(0,i.A)((function*(){var t,r=yield e.getKey(!1);if(!r)return!1;try{t=yield e.http.authedRequest(y.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:R})}catch(d){var n=d;if("M_NOT_FOUND"===n.errcode||"M_UNRECOGNIZED"===n.errcode)return e.logger.info("dehydration: No dehydrated device"),!1;throw n}e.logger.info("dehydration: dehydrated device found"),e.emit(b.CryptoEvent.RehydrationStarted);var i=yield e.olmMachine.dehydratedDevices().rehydrate(r,new o.DeviceId(t.device_id),JSON.stringify(t.device_data));e.logger.info("dehydration: device rehydrated");var s=void 0,_=0,c=0,a=(0,f.RR)("/dehydrated_device/$device_id/events",{$device_id:t.device_id});while(1){var u=yield e.http.authedRequest(y.IT.Post,a,void 0,s?{next_batch:s}:{},{prefix:R});if(0===u.events.length)break;_+=u.events.length,s=u.next_batch;var g=yield i.receiveEvents(JSON.stringify(u.events));c+=g.length,e.emit(b.CryptoEvent.RehydrationProgress,c,_)}return e.logger.info("dehydration: received ".concat(c," room keys from ").concat(_," to-device events")),e.emit(b.CryptoEvent.RehydrationCompleted),!0}))()}createAndUploadDehydratedDevice(){var e=this;return(0,i.A)((function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(b.CryptoEvent.DehydratedDeviceCreated);var n=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(n),e.emit(b.CryptoEvent.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")}))()}scheduleDeviceDehydration(){var e=this;return(0,i.A)((function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval((()=>{e.createAndUploadDehydratedDevice().catch((t=>{e.emit(b.CryptoEvent.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)}))}),K)}))()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class O{constructor(e,t){this.olmMachine=e,this.http=t}makeOutgoingRequest(e,t){var r=this;return(0,i.A)((function*(){var n;if(e instanceof o.KeysUploadRequest)n=yield r.requestWithRetry(y.IT.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof o.KeysQueryRequest)n=yield r.requestWithRetry(y.IT.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof o.KeysClaimRequest)n=yield r.requestWithRetry(y.IT.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof o.SignatureUploadRequest)n=yield r.requestWithRetry(y.IT.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof o.KeysBackupRequest)n=yield r.requestWithRetry(y.IT.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof o.ToDeviceRequest)n=yield r.sendToDeviceRequest(e);else if(e instanceof o.RoomMessageRequest){var s="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));n=yield r.requestWithRetry(y.IT.Put,s,{},e.body)}else{if(e instanceof o.UploadSigningKeysRequest)return void(yield r.makeRequestWithUIA(y.IT.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t));if(e instanceof o.PutDehydratedDeviceRequest){var _=R+"/dehydrated_device";return void(yield r.rawJsonRequest(y.IT.Put,_,{},e.body))}p.v.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),n=""}if(e.id)try{yield(0,f.NQ)(p.v,"Mark Request as sent ".concat(e.type),(0,i.A)((function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,n)})))}catch(c){if(!(c instanceof Error)||"Attempt to use a moved value"!==c.message&&"null pointer passed to rust"!==c.message)throw c;p.v.log("Ignoring error '".concat(c.message,"': client is likely shutting down"))}else p.v.trace("Outgoing request type:".concat(e.type," does not have an ID"))}))()}sendToDeviceRequest(e){var t=this;return(0,i.A)((function*(){var r=JSON.parse(e.body),n=[];for(var[i,o]of Object.entries(r.messages))for(var[s,_]of Object.entries(o))n.push("".concat(i,"/").concat(s," (msgid ").concat(_[w.wt],")"));p.v.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),n);var c="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(y.IT.Put,c,{},e.body)}))()}makeRequestWithUIA(e,t,r,n,o){var s=this;return(0,i.A)((function*(){if(!o)return yield s.requestWithRetry(e,t,r,n);var _=JSON.parse(n),c=function(){var n=(0,i.A)((function*(n){var i=D({},_);null!==n&&(i.auth=n);var o=yield s.requestWithRetry(e,t,r,JSON.stringify(i));return JSON.parse(o)}));return function(e){return n.apply(this,arguments)}}(),a=yield o(c);return JSON.stringify(a)}))()}requestWithRetry(e,t,r,n){var o=this;return(0,i.A)((function*(){var i=0;while(1)try{return yield o.rawJsonRequest(e,t,r,n)}catch(_){i++;var s=(0,y.fZ)(_,i,!0);if(s<0)throw _;yield(0,f.yy)(s)}}))()}rawJsonRequest(e,t,r,n){var o=this;return(0,i.A)((function*(){var i={json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:""};return yield o.http.authedRequest(e,t,r,n,i)}))()}}class M{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,(0,n.A)(this,"currentClaimPromise",void 0),(0,n.A)(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch((()=>{})).then((()=>this.ensureSessionsForUsersInner(e,t)));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return(0,i.A)((function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var n=yield r.olmMachine.getMissingSessions(t.map((e=>e.clone())));n&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(n)),e.info("Olm sessions prepared")}))()}}var q=r(4178);function A(e,t){var r=new Map;for(var[n,i]of e.keys.entries())r.set(n.toString(),i.toBase64());var s=q.u.Unverified;e.isBlacklisted()?s=q.u.Blocked:e.isVerified()&&(s=q.u.Verified);var _=new Map,c=e.signatures.get(t);if(c){var a=new Map;for(var[u,g]of c.entries())g.isValid()&&g.signature&&a.set(u,g.signature.toBase64());_.set(t.toString(),a)}var d=e.algorithms,l=new Set;return d.forEach((e=>{switch(e){case o.EncryptionAlgorithm.MegolmV1AesSha2:l.add("m.megolm.v1.aes-sha2");break;case o.EncryptionAlgorithm.OlmV1Curve25519AesSha2:default:l.add("m.olm.v1.curve25519-aes-sha2");break}})),new q.p({deviceId:e.deviceId.toString(),userId:t.toString(),keys:r,algorithms:Array.from(l),verified:s,signatures:_,displayName:e.displayName,dehydrated:e.isDehydrated})}function B(e){return new Map(Object.entries(e).map((e=>{var[t,r]=e;return[t,V(r)]})))}function V(e){var t,r=new Map(Object.entries(e.keys)),n=null===(t=e.unsigned)||void 0===t?void 0:t.device_display_name,i=new Map;if(e.signatures)for(var o in e.signatures)i.set(o,new Map(Object.entries(e.signatures[o])));return new q.p({deviceId:e.device_id,userId:e.user_id,keys:r,algorithms:e.algorithms,verified:q.u.Unverified,signatures:i,displayName:n})}var U=r(1915);class F{constructor(e,t,r){this.olmMachine=e,this.outgoingRequestProcessor=t,this.secretStorage=r}bootstrapCrossSigning(e){var t=this;return(0,i.A)((function*(){if(e.setupNewCrossSigning)yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);else{var r=yield t.olmMachine.crossSigningStatus(),n=yield t.secretStorage.get("m.cross_signing.master"),i=yield t.secretStorage.get("m.cross_signing.self_signing"),o=yield t.secretStorage.get("m.cross_signing.user_signing"),s=Boolean(n&&i&&o),_=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(p.v.log("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:s}),_)(yield t.secretStorage.hasKey())?s?p.v.log("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(p.v.log("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):p.v.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(s){p.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var c=yield t.olmMachine.importCrossSigningKeys(n,i,o);if(!c.hasMaster||!c.hasSelfSigning||!c.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var a=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var u=yield a.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(u)}finally{a.free()}}else p.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);p.v.log("bootstrapCrossSigning: complete")}}))()}resetCrossSigning(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);for(var n of((yield t.secretStorage.hasKey())?(p.v.log("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):p.v.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),p.v.log("resetCrossSigning: publishing public keys to server"),[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest]))n&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(n,e))}))()}exportCrossSigningKeysToStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.exportCrossSigningKeys();null!==t&&void 0!==t&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):p.v.error("Cannot export MSK to secret storage, private key unknown"),null!==t&&void 0!==t&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):p.v.error("Cannot export SSK to secret storage, private key unknown"),null!==t&&void 0!==t&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):p.v.error("Cannot export USK to secret storage, private key unknown")}))()}}function T(e){return P.apply(this,arguments)}function P(){return P=(0,i.A)((function*(e){return N(e,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])})),P.apply(this,arguments)}function N(e,t){return x.apply(this,arguments)}function x(){return x=(0,i.A)((function*(e,t){var r=yield e.getDefaultKeyId();if(!r)return!1;for(var n of t){var i=(yield e.isStored(n))||{};if(!(r in i))return!1}return!0})),x.apply(this,arguments)}r(3579);var z=r(7841),j=r(5462),L=r(5942);class W extends S.X{constructor(e,t,r,o){super(),this.olmMachine=e,this.inner=t,this.outgoingRequestProcessor=r,this.supportedVerificationMethods=o,(0,n.A)(this,"reEmitter",void 0),(0,n.A)(this,"_accepting",!1),(0,n.A)(this,"_cancelling",!1),(0,n.A)(this,"_verifier",void 0),this.reEmitter=new j.Q(this);var s=new WeakRef(this);t.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=s.deref())||void 0===e?void 0:e.onChange()})))}onChange(){var e=this.inner.getVerification();e instanceof o.Sas?void 0===this._verifier||this._verifier instanceof Q?this.setVerifier(new J(e,this,this.outgoingRequestProcessor)):this._verifier instanceof J&&this._verifier.replaceInner(e):e instanceof o.Qr&&void 0===this._verifier&&this.setVerifier(new Q(e,this.outgoingRequestProcessor)),this.emit(z.FM.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[z.FM.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[z.FM.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return null===(e=this.inner.roomId)||void 0===e?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return null===(e=this.inner.otherDeviceId)||void 0===e?void 0:e.toString()}getOtherDevice(){var e=this;return(0,i.A)((function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)}))()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case o.VerificationRequestPhase.Created:case o.VerificationRequestPhase.Requested:return z.X9.Requested;case o.VerificationRequestPhase.Ready:return this._accepting?z.X9.Requested:z.X9.Ready;case o.VerificationRequestPhase.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case o.VerificationRequestPhase.Done:return z.X9.Done;case o.VerificationRequestPhase.Cancelled:return z.X9.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==z.X9.Done&&e!==z.X9.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==z.X9.Started)return null;var e=this.inner.getVerification();return e instanceof o.Sas?L.V.Sas:e instanceof o.Qr?L.V.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(void 0===t)return!1;var r=H[e];return t.some((e=>e===r))}accept(){var e=this;return(0,i.A)((function*(){if(e.inner.phase()!==o.VerificationRequestPhase.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(Y));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(z.FM.Change)}))()}cancel(e){var t=this;return(0,i.A)((function*(){if(!t._cancelling){t._cancelling=!0;try{var e=t.inner.cancel();e&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(e))}finally{t._cancelling=!1}}}))()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return(0,i.A)((function*(){if(e!==L.V.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,n]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier}))()}scanQRCode(e){var t=this;return(0,i.A)((function*(){var r=o.QrCodeScan.fromBytes(e),n=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var i=n.reciprocate();return i&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(i)),t._verifier}))()}get verifier(){return this.phase===z.X9.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return(0,i.A)((function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()}))()}get cancellationCode(){var e,t;return null!==(e=null===(t=this.inner.cancelInfo)||void 0===t?void 0:t.cancelCode())&&void 0!==e?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;return e?e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString():void 0}}class G extends S.X{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,(0,n.A)(this,"completionDeferred",void 0),this.completionDeferred=(0,f.v6)();var r=new WeakRef(this);e.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=r.deref())||void 0===e?void 0:e.onChange()}))),this.completionDeferred.promise.catch((()=>null))}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(z.FM.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}class Q extends G{constructor(e,t){super(e,t),(0,n.A)(this,"callbacks",null)}onChange(){null===this.callbacks&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:()=>{this.confirmScanning()},cancel:()=>this.cancel()}),super.onChange()}verify(){var e=this;return(0,i.A)((function*(){null!==e.callbacks&&e.emit(z.Ji.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise}))()}get verificationPhase(){switch(this.inner.state()){case o.QrState.Created:return z.X9.Ready;case o.QrState.Scanned:return z.X9.Started;case o.QrState.Confirmed:return z.X9.Started;case o.QrState.Reciprocated:return z.X9.Started;case o.QrState.Done:return z.X9.Done;case o.QrState.Cancelled:return z.X9.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return(0,i.A)((function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}}class J extends G{constructor(e,t,r){super(e,r),(0,n.A)(this,"callbacks",null)}verify(){var e=this;return(0,i.A)((function*(){yield e.sendAccept(),yield e.completionDeferred.promise}))()}sendAccept(){var e=this;return(0,i.A)((function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}onChange(){var e=this;if(super.onChange(),null===this.callbacks){var t=this.inner.emoji(),r=this.inner.decimals();if(void 0===t&&void 0===r)return;var n={};t&&(n.emoji=t.map((e=>[e.symbol,e.description]))),r&&(n.decimal=[r[0],r[1],r[2]]),this.callbacks={sas:n,confirm:function(){var t=(0,i.A)((function*(){var t=yield e.inner.confirm();for(var r of t)yield e.outgoingRequestProcessor.makeOutgoingRequest(r)}));function r(){return t.apply(this,arguments)}return r}(),mismatch:()=>{var e=this.inner.cancelWithCode("m.mismatched_sas");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)},cancel:()=>{var e=this.inner.cancelWithCode("m.user");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)}},this.emit(z.Ji.ShowSas,this.callbacks)}}get verificationPhase(){return z.X9.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback((0,i.A)((function*(){var e;return null===(e=t.deref())||void 0===e?void 0:e.onChange()}))),this.sendAccept(),this.onChange()}}}var H={[L.V.Sas]:o.VerificationMethod.SasV1,[L.V.ScanQrCode]:o.VerificationMethod.QrCodeScanV1,[L.V.ShowQrCode]:o.VerificationMethod.QrCodeShowV1,[L.V.Reciprocate]:o.VerificationMethod.ReciprocateV1};function Y(e){var t=H[e];if(void 0===t)throw new Error("Unknown verification method ".concat(e));return t}function X(e){switch(e.getType()){case w.Bx.KeyVerificationCancel:case w.Bx.KeyVerificationDone:case w.Bx.KeyVerificationMac:case w.Bx.KeyVerificationStart:case w.Bx.KeyVerificationKey:case w.Bx.KeyVerificationReady:case w.Bx.KeyVerificationAccept:return!0;case w.Bx.RoomMessage:return e.getContent().msgtype===w.Wr.KeyVerificationRequest;default:return!1}}class $ extends S.X{constructor(e,t,r){super(),this.olmMachine=e,this.http=t,this.outgoingRequestProcessor=r,(0,n.A)(this,"checkedForBackup",!1),(0,n.A)(this,"serverBackupInfo",void 0),(0,n.A)(this,"activeBackupVersion",null),(0,n.A)(this,"stopped",!1),(0,n.A)(this,"backupKeysLoopRunning",!1),(0,n.A)(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return(0,i.A)((function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null}))()}getServerBackupInfo(){var e=this;return(0,i.A)((function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo}))()}isKeyBackupTrusted(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.verifyBackup(e),n=yield t.olmMachine.getBackupKeys(),i=null===n||void 0===n?void 0:n.decryptionKey,o=!!i&&Z(e,i);return{matchesDecryptionKey:o,trusted:r.trusted()}}))()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally((()=>{this.keyBackupCheckInProgress=null}))),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return(0,i.A)((function*(){var r,n=yield t.checkKeyBackupAndEnable(!0);if(null===n||void 0===n||null===(r=n.backupInfo)||void 0===r||!r.version||!n.trustInfo.trusted)return p.v.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var i=o.BackupDecryptionKey.fromBase64(e),s=Z(n.backupInfo,i);return s?(p.v.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(i,n.backupInfo.version),!0):(p.v.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(_){p.v.warn("handleBackupSecretReceived: Invalid backup decryption key",_)}return!1}))()}saveBackupDecryptionKey(e,t){var r=this;return(0,i.A)((function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(b.CryptoEvent.KeyBackupDecryptionKeyCached,t)}))()}importRoomKeys(e,t){var r=this;return(0,i.A)((function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,i.A)((function*(){yield r.olmMachine.importExportedRoomKeys(e,((e,r)=>{var n,i={total:Number(r),successes:Number(e),stage:"load_keys",failures:0};null===t||void 0===t||null===(n=t.progressCallback)||void 0===n||n.call(t,i)}))}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,i.A)((function*(){var i=new Map;for(var s of e){var _=new o.RoomId(s.room_id);i.has(_)||i.set(_,new Map),i.get(_).set(s.session_id,s)}yield n.olmMachine.importBackedUpRoomKeys(i,((e,t,n)=>{var i,o={total:Number(t),successes:Number(e),stage:"load_keys",failures:Number(n)};null===r||void 0===r||null===(i=r.progressCallback)||void 0===i||i.call(r,o)}),t)}))()}doCheckKeyBackup(){var e=this;return(0,i.A)((function*(){var t;p.v.log("Checking key backup status...");try{t=yield e.requestKeyBackupVersion()}catch(i){return p.v.warn("Error checking for active key backup",i),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(p.v.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return null!==r?(p.v.log("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):p.v.log("No key backup present on server: not enabling key backup"),null;var n=yield e.isKeyBackupTrusted(t);return n.trusted?null===r?(p.v.log("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(p.v.log("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):p.v.log("Backup version ".concat(t.version," still current")):null!==r?(p.v.log("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):p.v.log("Key backup present on server but not trusted: not enabling key backup"),{backupInfo:t,trustInfo:n}}))()}enableKeyBackup(e){var t=this;return(0,i.A)((function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(b.CryptoEvent.KeyBackupStatus,!0),t.backupKeysLoop()}))()}maybeUploadKey(){var e=this;return(0,i.A)((function*(){null!=e.activeBackupVersion&&e.backupKeysLoop()}))()}disableKeyBackup(){var e=this;return(0,i.A)((function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(b.CryptoEvent.KeyBackupStatus,!1)}))()}backupKeysLoop(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:1e4;if(t.backupKeysLoopRunning)p.v.log("Backup loop already running");else{t.backupKeysLoopRunning=!0,p.v.log("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var n=Math.random()*r;yield(0,f.yy)(n);try{var o=0,s=null,_=!0;while(!t.stopped){var c=null;try{c=yield(0,f.NQ)(p.v,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",(0,i.A)((function*(){return yield t.olmMachine.backupRoomKeys()})))}catch(l){p.v.error("Backup: Failed to get keys to backup from rust crypto-sdk",l)}if(!c||t.stopped||!t.activeBackupVersion)return p.v.log("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),void(c||t.emit(b.CryptoEvent.KeyBackupSessionsRemaining,0));try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(c),o=0,t.stopped)break;if(!_&&null===s)try{var a=yield t.olmMachine.roomKeyCounts();s=a.total-a.backedUp}catch(l){p.v.error("Backup: Failed to get key counts from rust crypto-sdk",l)}if(null!==s){t.emit(b.CryptoEvent.KeyBackupSessionsRemaining,s);var u=t.keysCountInBatch(c);s=Math.max(s-u,0)}}catch(l){if(o++,p.v.error("Backup: Error processing backup request for rust crypto-sdk",l),l instanceof y.up){var g=l.data.errcode;if("M_NOT_FOUND"==g||"M_WRONG_ROOM_KEYS_VERSION"==g){p.v.log("Backup: Failed to upload keys to current vesion: ".concat(g,"."));try{yield t.disableKeyBackup()}catch(w){p.v.error("Backup: An error occurred while disabling key backup:",w)}return t.emit(b.CryptoEvent.KeyBackupFailed,l.data.errcode),t.backupKeysLoopRunning=!1,void t.checkKeyBackupAndEnable(!0)}if(l.isRateLimitError())try{var d=l.getRetryAfterMs();if(d&&d>0){yield(0,f.yy)(d);continue}}catch(w){p.v.warn("Backup: An error occurred while retrieving a rate-limit retry delay",w)}}yield(0,f.yy)(1e3*Math.pow(2,Math.min(o-1,4)))}_=!1}}finally{t.backupKeysLoopRunning=!1}}}))()}keysCountInBatch(e){var t=JSON.parse(e.body);return ie(t)}requestKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){return yield te(t.http,e)}))()}setupKeyBackup(e){var t=this;return(0,i.A)((function*(){yield t.deleteAllKeyBackupVersions();var r=o.BackupDecryptionKey.createRandomKey(),n=r.megolmV1PublicKey,i={public_key:n.publicKeyBase64};yield e(i);var s=yield t.http.authedRequest(y.IT.Post,"/room_keys/version",void 0,{algorithm:n.algorithm,auth_data:i},{prefix:y.iD.V3});return yield t.saveBackupDecryptionKey(r,s.version),{version:s.version,algorithm:n.algorithm,authData:i,decryptionKey:r}}))()}deleteAllKeyBackupVersions(){var e=this;return(0,i.A)((function*(){var t,r,n=null!==(t=null===(r=yield e.requestKeyBackupVersion())||void 0===r?void 0:r.version)&&void 0!==t?t:null;while(null!=n){var i,o;yield e.deleteKeyBackupVersion(n),n=null!==(i=null===(o=yield e.requestKeyBackupVersion())||void 0===o?void 0:o.version)&&void 0!==i?i:null}}))()}deleteKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){p.v.debug("deleteKeyBackupVersion v:".concat(e));var r=(0,f.RR)("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(y.IT.Delete,r,void 0,void 0,{prefix:y.iD.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())}))()}createBackupDecryptor(e){return new ee(e)}restoreKeyBackup(e,t,r){var n=this;return(0,i.A)((function*(){var i,o=yield n.downloadKeyBackup(e);return null===r||void 0===r||null===(i=r.progressCallback)||void 0===i||i.call(r,{stage:"load_keys"}),n.importKeyBackup(o,e,t,r)}))()}downloadKeyBackup(e){return this.http.authedRequest(y.IT.Get,"/room_keys/keys",{version:e},void 0,{prefix:y.iD.V3})}importKeyBackup(e,t,r,n){var o=this;return(0,i.A)((function*(){var s=200,_=ie(e),c=0,a=0,u=function(){var e=(0,i.A)((function*(e){var i,s=[],u=function*(t){var n=yield r.decryptSessions(e.get(t));n.forEach((e=>{e.room_id=t,s.push(e)}))};for(var g of e.keys())yield*u(g);try{yield o.importBackedUpRoomKeys(s,t),c+=s.length}catch(d){a+=s.length,p.v.error("Error importing keys from backup",d)}null===n||void 0===n||null===(i=n.progressCallback)||void 0===i||i.call(n,{total:_,successes:c,stage:"load_keys",failures:a})}));return function(t){return e.apply(this,arguments)}}(),g=0,d=new Map;for(var[l,y]of Object.entries(e.rooms))if(y.sessions)for(var[w,h]of(d.set(l,{}),Object.entries(y.sessions))){var f=d.get(l);f[w]=h,g+=1,g>=s&&(yield u(d),d=new Map,d.set(l,{}),g=0)}return g>0&&(yield u(d)),{total:_,imported:c}}))()}}function Z(e,t){var r;return"m.megolm_backup.v1.curve25519-aes-sha2"!==e.algorithm?(p.v.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):(null===(r=e.auth_data)||void 0===r?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}class ee{constructor(e){(0,n.A)(this,"decryptionKey",void 0),(0,n.A)(this,"sourceTrusted",void 0),this.decryptionKey=e,this.sourceTrusted=!1}decryptSessions(e){var t=this;return(0,i.A)((function*(){var r=[];for(var[n,i]of Object.entries(e))try{var o=JSON.parse(t.decryptionKey.decryptV1(i.session_data.ephemeral,i.session_data.mac,i.session_data.ciphertext));o.session_id=n,r.push(o)}catch(s){p.v.log("Failed to decrypt megolm session from backup",s,i)}return r}))()}free(){this.decryptionKey.free()}}function te(e,t){return re.apply(this,arguments)}function re(){return re=(0,i.A)((function*(e,t){try{var r=t?(0,f.RR)("/room_keys/version/$version",{$version:t}):"/room_keys/version";return yield e.authedRequest(y.IT.Get,r,void 0,void 0,{prefix:y.iD.V3})}catch(n){if("M_NOT_FOUND"===n.errcode)return null;throw n}})),re.apply(this,arguments)}function ne(e,t){var r=t.auth_data;return r.public_key===e.megolmV1PublicKey.publicKeyBase64}function ie(e){var t=0;for(var{sessions:r}of Object.values(e.rooms))t+=Object.keys(r).length;return t}var oe=r(9553),se=r(6536);class _e{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,(0,n.A)(this,"stopped",!1),(0,n.A)(this,"outgoingRequestLoopRunning",!1),(0,n.A)(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=(0,f.v6)());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch((e=>{this.logger.error("Uncaught error in outgoing request loop",e)})),e}outgoingRequestLoop(){var e=this;return(0,i.A)((function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{while(!e.stopped&&e.nextLoopDeferred){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))}))()}processOutgoingRequests(){var e=this;return(0,i.A)((function*(){if(!e.stopped){var t,r=yield e.olmMachine.outgoingRequests(),n=function*(t){if(e.stopped)return{v:void 0};try{yield(0,f.NQ)(e.logger,"Make outgoing request ".concat(t.type),(0,i.A)((function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(t)})))}catch(r){e.logger.error("Failed to process outgoing request ".concat(t.type,": ").concat(r))}};for(var o of r)if(t=yield*n(o),t)return t.v}}))()}}var ce=5e3,ae=function(e){return e["MISSING_DECRYPTION_KEY"]="MISSING_DECRYPTION_KEY",e["NETWORK_ERROR"]="NETWORK_ERROR",e["STOPPED"]="STOPPED",e}(ae||{});class ue extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}}class ge extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}}class de{constructor(e,t,r,i){this.olmMachine=t,this.http=r,this.backupManager=i,(0,n.A)(this,"stopped",!1),(0,n.A)(this,"configuration",null),(0,n.A)(this,"sessionLastCheckAttemptedTime",new Map),(0,n.A)(this,"logger",void 0),(0,n.A)(this,"downloadLoopRunning",!1),(0,n.A)(this,"queuedRequests",[]),(0,n.A)(this,"hasConfigurationProblem",!1),(0,n.A)(this,"currentBackupVersionCheck",null),(0,n.A)(this,"onBackupStatusChanged",(()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then((e=>{e&&this.downloadKeysLoop()}))})),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),i.on(b.CryptoEvent.KeyBackupStatus,this.onBackupStatusChanged),i.on(b.CryptoEvent.KeyBackupFailed,this.onBackupStatusChanged),i.on(b.CryptoEvent.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return null!==this.configuration}getServerBackupInfo(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.getServerBackupInfo()}))()}onDecryptionKeyMissingError(e,t){this.isAlreadyInQueue(e,t)?this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued")):this.wasRequestedRecently(t)?this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently")):(this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop())}stop(){this.stopped=!0,this.backupManager.off(b.CryptoEvent.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(b.CryptoEvent.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(b.CryptoEvent.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some((r=>r.roomId==e&&r.megolmSessionId==t))}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter(((e,r)=>Math.max(t-r,0)<ce))))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return!!t&&Math.max(Date.now()-t,0)<ce}getBackupDecryptionKey(){var e=this;return(0,i.A)((function*(){try{return yield e.olmMachine.getBackupKeys()}catch(t){return null}}))()}requestRoomKeyFromBackup(e,t,r){var n=this;return(0,i.A)((function*(){var i=(0,f.RR)("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield n.http.authedRequest(y.IT.Get,i,{version:e},void 0,{prefix:y.iD.V3})}))()}downloadKeysLoop(){var e=this;return(0,i.A)((function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{while(e.queuedRequests.length>0){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r)return void(e.downloadLoopRunning=!1);var n=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,n,r)}catch(i){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),i)}e.queuedRequests.shift()}catch(o){if(o instanceof ue)switch(o.code){case ae.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case ae.NETWORK_ERROR:yield(0,f.yy)(ce);break;case ae.STOPPED:return void(e.downloadLoopRunning=!1)}else o instanceof ge&&(yield(0,f.yy)(o.retryMillis))}}}finally{e.downloadLoopRunning=!1}}}))()}queryKeyBackup(e,t,r){var n=this;return(0,i.A)((function*(){if(n.logger.debug("Checking key backup for session ".concat(t)),n.stopped)throw new ue(ae.STOPPED);try{var i=yield n.requestRoomKeyFromBackup(r.backupVersion,e,t);return n.logger.debug("Got key from backup for sessionId:".concat(t)),i}catch(a){if(n.stopped)throw new ue(ae.STOPPED);if(n.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(a)),a instanceof y.up){var o=a.data.errcode;if("M_NOT_FOUND"==o)throw new ue(ae.MISSING_DECRYPTION_KEY);if(a.isRateLimitError()){var s,_;try{var c;_=null!==(c=a.getRetryAfterMs())&&void 0!==c?c:void 0}catch(u){n.logger.warn("Error while retrieving a rate-limit retry delay",u)}throw _&&_>0&&n.logger.info("Rate limited by server, waiting ".concat(_,"ms")),new ge(null!==(s=_)&&void 0!==s?s:ce)}}throw new ue(ae.NETWORK_ERROR)}}))()}decryptAndImport(e,t,r){var n=this;return(0,i.A)((function*(){var i={[e.megolmSessionId]:t},o=yield r.decryptor.decryptSessions(i);for(var s of o)s.room_id=e.roomId;yield n.backupManager.importBackedUpRoomKeys(o,r.backupVersion)}))()}getOrCreateBackupConfiguration(){var e=this;return(0,i.A)((function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(null!=e.currentBackupVersionCheck)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}}))()}internalCheckFromServer(){var e=this;return(0,i.A)((function*(){var t,r,n,i,o=null;try{o=yield e.backupManager.getServerBackupInfo()}catch(u){return e.logger.debug("Backup: error while checking server version: ".concat(u)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat(null===(t=o)||void 0===t?void 0:t.version)),"m.megolm_backup.v1.curve25519-aes-sha2"!=(null===(r=o)||void 0===r?void 0:r.algorithm))return e.logger.info("Unsupported algorithm ".concat(null===(i=o)||void 0===i?void 0:i.algorithm)),e.hasConfigurationProblem=!0,null;if(null===(n=o)||void 0===n||!n.version)return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var s=yield e.backupManager.getActiveBackupVersion();if(null==s||o.version!=s)return e.logger.info("The current backup version on the server (".concat(o.version,") is not trusted. Version we are currently backing up to: ").concat(s)),e.hasConfigurationProblem=!0,null;var _=yield e.getBackupDecryptionKey();if(null===_||void 0===_||!_.decryptionKey)return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(s!=_.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(_.backupVersion,") doesn't match the version we are backing up to (").concat(s,")")),e.hasConfigurationProblem=!0,null;var c=o.auth_data;if(c.public_key!=_.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var a=e.backupManager.createBackupDecryptor(_.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:a,backupVersion:s},e.configuration}))()}}var le=r(8695);function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var we=[L.V.Sas,L.V.ScanQrCode,L.V.ShowQrCode,L.V.Reciprocate];class he extends S.X{constructor(e,t,r,i,o,s,_){super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=i,this.secretStorage=s,this.cryptoCallbacks=_,(0,n.A)(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),(0,n.A)(this,"_trustCrossSignedDevices",!0),(0,n.A)(this,"deviceIsolationMode",new b.AllDevicesIsolationMode(!1)),(0,n.A)(this,"stopped",!1),(0,n.A)(this,"roomEncryptors",{}),(0,n.A)(this,"eventDecryptor",void 0),(0,n.A)(this,"keyClaimManager",void 0),(0,n.A)(this,"outgoingRequestProcessor",void 0),(0,n.A)(this,"crossSigningIdentity",void 0),(0,n.A)(this,"backupManager",void 0),(0,n.A)(this,"outgoingRequestsManager",void 0),(0,n.A)(this,"perSessionBackupDownloader",void 0),(0,n.A)(this,"dehydratedDeviceManager",void 0),(0,n.A)(this,"reemitter",new j.Q(this)),(0,n.A)(this,"globalBlacklistUnverifiedDevices",!1),(0,n.A)(this,"_supportedVerificationMethods",we),this.outgoingRequestProcessor=new O(t,r),this.outgoingRequestsManager=new _e(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new M(t,this.outgoingRequestProcessor),this.backupManager=new $(t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new de(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new C(this.logger,t,r,this.outgoingRequestProcessor,s),this.eventDecryptor=new fe(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[b.CryptoEvent.KeyBackupStatus,b.CryptoEvent.KeyBackupSessionsRemaining,b.CryptoEvent.KeyBackupFailed,b.CryptoEvent.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[b.CryptoEvent.DehydratedDeviceCreated,b.CryptoEvent.DehydratedDeviceUploaded,b.CryptoEvent.RehydrationStarted,b.CryptoEvent.RehydrationProgress,b.CryptoEvent.RehydrationCompleted,b.CryptoEvent.RehydrationError,b.CryptoEvent.DehydrationKeyCached,b.CryptoEvent.DehydratedDeviceRotationError]),this.crossSigningIdentity=new F(t,this.outgoingRequestProcessor,s),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new se.LA;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return(0,i.A)((function*(){var t=e.getRoomId(),n=r.roomEncryptors[t];if(!n)throw new Error("Cannot encrypt event in unconfigured room ".concat(t));yield n.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)}))()}decryptEvent(e){var t=this;return(0,i.A)((function*(){var r=e.getRoomId();if(!r)throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)}))()}getEventEncryptionInfo(e){var t,r={};return r.senderKey=null!==(t=e.getSenderKey())&&void 0!==t?t:void 0,r.algorithm=e.getWireContent().algorithm,r.senderKey&&r.algorithm?(r.encrypted=!0,r.authenticated=!0,r.mismatchedSender=!0,r):(r.encrypted=!1,r)}checkUserTrust(e){return new b.UserVerificationStatus(!1,!1,!1)}getStoredCrossSigningForUser(e){return null}checkOwnCrossSigningTrust(){return(0,i.A)((function*(){}))()}getBackupDecryptor(e,t){var r=this;return(0,i.A)((function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if("m.megolm_backup.v1.curve25519-aes-sha2"!=e.algorithm)throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var n=o.BackupDecryptionKey.fromBase64((0,k.WG)(t));if(!ne(n,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(n)}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,i.A)((function*(){return yield n.backupManager.importBackedUpRoomKeys(e,t,r)}))()}getVersion(){var e=o.getVersions();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getRoomSettings(new o.RoomId(e));return Boolean(null===r||void 0===r?void 0:r.algorithm)}))()}getOwnDeviceKeys(){var e=this;return(0,i.A)((function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}}))()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return null===(t=this.roomEncryptors[e])||void 0===t?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.exportRoomKeys((()=>!0));return JSON.parse(t)}))()}exportRoomKeysAsJson(){var e=this;return(0,i.A)((function*(){return yield e.olmMachine.exportRoomKeys((()=>!0))}))()}importRoomKeys(e,t){var r=this;return(0,i.A)((function*(){return yield r.backupManager.importRoomKeys(e,t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,i.A)((function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)}))()}userHasCrossSigningKeys(){var e=arguments,t=this;return(0,i.A)((function*(){var r,n=e.length>0&&void 0!==e[0]?e[0]:t.userId,i=e.length>1&&void 0!==e[1]&&e[1],o=yield t.olmMachine.trackedUsers();for(var s of o)if(n===s.toString()){r=s;break}if(void 0!==r){if(n===t.userId){var _=t.olmMachine.queryKeysForUsers([r.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(_)}var c=yield t.olmMachine.getIdentity(r);return null===c||void 0===c||c.free(),void 0!==c}if(i){var a,u=yield t.downloadDeviceList(new Set([n])),g=null===(a=u.master_keys)||void 0===a?void 0:a[n];return!!g&&Boolean(Object.values(g.keys)[0])}return!1}))()}getUserDeviceInfo(e){var t=arguments,r=this;return(0,i.A)((function*(){var n=t.length>1&&void 0!==t[1]&&t[1],i=new Map,o=yield r.getOlmMachineOrThrow().trackedUsers(),s=new Set;o.forEach((e=>s.add(e.toString())));var _=new Set;for(var c of e)s.has(c)?i.set(c,yield r.getUserDevices(c)):_.add(c);if(n&&_.size>=1){var a=yield r.downloadDeviceList(_);Object.entries(a.device_keys).forEach((e=>{var[t,r]=e;return i.set(t,B(r))}))}return i}))()}getUserDevices(e){var t=this;return(0,i.A)((function*(){var r=new o.UserId(e),n=yield t.olmMachine.getUserDevices(r,1);try{var i=n.devices();try{return new Map(i.map((e=>[e.deviceId.toString(),A(e,r)])))}finally{i.forEach((e=>e.free()))}}finally{n.free()}}))()}downloadDeviceList(e){var t=this;return(0,i.A)((function*(){var r={device_keys:{}};return e.forEach((e=>r.device_keys[e]=[])),yield t.http.authedRequest(y.IT.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})}))()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,n=this;return(0,i.A)((function*(){var i=!(r.length>2&&void 0!==r[2])||r[2],s=yield n.olmMachine.getDevice(new o.UserId(e),new o.DeviceId(t));if(!s)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield s.setLocalTrust(i?o.LocalTrust.Verified:o.LocalTrust.Unset)}finally{s.free()}}))()}crossSignDevice(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getDevice(new o.UserId(t.userId),new o.DeviceId(e));if(!r)throw new Error("Unknown device ".concat(e));try{var n=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}finally{r.free()}}))()}getDeviceVerificationStatus(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getDevice(new o.UserId(e),new o.DeviceId(t));if(!n)return null;try{return new b.DeviceVerificationStatus({signedByOwner:n.isCrossSignedByOwner(),crossSigningVerified:n.isCrossSigningTrusted(),localVerified:n.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{n.free()}}))()}getUserVerificationStatus(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new o.UserId(e));if(void 0===r)return new b.UserVerificationStatus(!1,!1,!1);var n=r.isVerified(),i=r.wasPreviouslyVerified(),s=r instanceof o.OtherUserIdentity&&r.identityNeedsUserApproval();return r.free(),new b.UserVerificationStatus(n,i,!1,s)}))()}pinCurrentUserIdentity(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new o.UserId(e));if(void 0===r)throw new Error("Cannot pin identity of unknown user");if(r instanceof o.OwnUserIdentity)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()}))()}withdrawVerificationRequirement(e){var t=this;return(0,i.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new o.UserId(e));if(void 0===r)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()}))()}isCrossSigningReady(){var e=this;return(0,i.A)((function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),n=Boolean(r.masterKey)&&Boolean(r.selfSigningKey)&&Boolean(r.userSigningKey),i=yield e.getOwnIdentity();return!(null===i||void 0===i||!i.isVerified())&&(n||t)}))()}getCrossSigningKeyId(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:b.CrossSigningKey.Master,n=yield t.olmMachine.getIdentity(new o.UserId(t.userId));if(!n)return null;try{var i,s=yield t.olmMachine.crossSigningStatus(),_=s.hasMaster&&s.hasUserSigning&&s.hasSelfSigning;if(!_)return null;if(!n.isVerified())return null;switch(r){case b.CrossSigningKey.Master:i=n.masterKey;break;case b.CrossSigningKey.SelfSigning:i=n.selfSigningKey;break;case b.CrossSigningKey.UserSigning:i=n.userSigningKey;break;default:return null}var c=JSON.parse(i);return Object.values(c.keys)[0]}finally{n.free()}}))()}bootstrapCrossSigning(e){var t=this;return(0,i.A)((function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)}))()}isSecretStorageReady(){var e=this;return(0,i.A)((function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"],r=null!=(yield e.backupManager.getActiveBackupVersion());return r&&t.push("m.megolm_backup.v1"),N(e.secretStorage,t)}))()}bootstrapSecretStorage(){var e=arguments,t=this;return(0,i.A)((function*(){var{createSecretStorageKey:r,setupNewSecretStorage:n,setupNewKeyBackup:i}=e.length>0&&void 0!==e[0]?e[0]:{},o=n||!(yield t.secretStorageHasAESKey());if(o){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var s=yield r();if(!s)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(s)}var _=yield t.olmMachine.crossSigningStatus(),c=_.hasMaster&&_.hasSelfSigning&&_.hasUserSigning;if(c&&(o||!(yield T(t.secretStorage)))){t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now.");var a=yield t.olmMachine.exportCrossSigningKeys();if(!a.masterKey)throw new Error("missing master key in cross signing private keys");if(!a.userSigningKey)throw new Error("missing user signing key in cross signing private keys");if(!a.self_signing_key)throw new Error("missing self signing key in cross signing private keys");yield t.secretStorage.store("m.cross_signing.master",a.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",a.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",a.self_signing_key)}i?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()}))()}saveBackupKeyToStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.backupManager.getServerBackupInfo();if(t&&t.version){var r=yield e.olmMachine.getBackupKeys();if(r.decryptionKey)if(ne(r.decryptionKey,t)){var n=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",n)}else p.v.info("Not saving backup key to secret storage: decryption key does not match backup info");else p.v.info("Not saving backup key to secret storage: no backup key")}else p.v.info("Not saving backup key to secret storage: no backup info")}))()}addSecretStorageKeyToSecretStorage(e){var t=this;return(0,i.A)((function*(){var r,n,i,o,s=yield t.secretStorage.addKey(U.SECRET_STORAGE_ALGORITHM_V1_AES,{passphrase:null===(r=e.keyInfo)||void 0===r?void 0:r.passphrase,name:null===(n=e.keyInfo)||void 0===n?void 0:n.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(s.keyId),null===(i=(o=t.cryptoCallbacks).cacheSecretStorageKey)||void 0===i||i.call(o,s.keyId,s.keyInfo,e.privateKey)}))()}secretStorageHasAESKey(){var e=this;return(0,i.A)((function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===U.SECRET_STORAGE_ALGORITHM_V1_AES}))()}getCrossSigningStatus(){var e=this;return(0,i.A)((function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new o.UserId(e.userId)),r=Boolean(null===t||void 0===t?void 0:t.masterKey)&&Boolean(null===t||void 0===t?void 0:t.selfSigningKey)&&Boolean(null===t||void 0===t?void 0:t.userSigningKey);null===t||void 0===t||t.free();var n=yield T(e.secretStorage),i=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:n,privateKeysCachedLocally:{masterKey:Boolean(null===i||void 0===i?void 0:i.hasMaster),userSigningKey:Boolean(null===i||void 0===i?void 0:i.hasUserSigning),selfSigningKey:Boolean(null===i||void 0===i?void 0:i.hasSelfSigning)}}}))()}createRecoveryKeyFromPassphrase(e){var t=this;return(0,i.A)((function*(){if(e){var r=(0,oe.US)(32),n=yield(0,b.deriveRecoveryKeyFromPassphrase)(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:n,encodedPrivateKey:(0,b.encodeRecoveryKey)(n)}}var i=new Uint8Array(32);return globalThis.crypto.getRandomValues(i),{privateKey:i,encodedPrivateKey:(0,b.encodeRecoveryKey)(i)}}))()}getEncryptionInfoForEvent(e){var t=this;return(0,i.A)((function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)}))()}getVerificationRequestsToDeviceInProgress(e){var t=this.olmMachine.getVerificationRequests(new o.UserId(e));return t.filter((e=>void 0===e.roomId)).map((e=>new W(this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new o.UserId(t)),n=r.find((t=>{var r;return(null===(r=t.roomId)||void 0===r?void 0:r.toString())===e}));if(n)return new W(this.olmMachine,n,this.outgoingRequestProcessor,this._supportedVerificationMethods)}requestVerificationDM(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getIdentity(new o.UserId(e));if(!n)throw new Error("unknown userId ".concat(e));try{var i=r._supportedVerificationMethods.map((e=>Y(e))),s=yield n.verificationRequestContent(i),_=yield r.sendVerificationRequestContent(t,s),c=yield n.requestVerification(new o.RoomId(t),new o.EventId(_),i);return new W(r.olmMachine,c,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}sendVerificationRequestContent(e,t){var r=this;return(0,i.A)((function*(){var n=(0,oe.US)(32),{event_id:i}=yield r.http.authedRequest(y.IT.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(n)),void 0,t,{prefix:""});return i}))()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=null!==e&&void 0!==e?e:we}requestOwnUserVerification(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.getIdentity(new o.UserId(e.userId));if(void 0===t)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,n]=yield t.requestVerification(e._supportedVerificationMethods.map(Y));return yield e.outgoingRequestProcessor.makeOutgoingRequest(n),new W(e.olmMachine,r,e.outgoingRequestProcessor,e._supportedVerificationMethods)}finally{t.free()}}))()}requestDeviceVerification(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.olmMachine.getDevice(new o.UserId(e),new o.DeviceId(t));if(!n)throw new Error("Not a known device");try{var[i,s]=n.requestVerification(r._supportedVerificationMethods.map(Y));return yield r.outgoingRequestProcessor.makeOutgoingRequest(s),new W(r.olmMachine,i,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}getSessionBackupPrivateKey(){var e=this;return(0,i.A)((function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?(0,k.y4)(t.decryptionKey.toBase64()):null}))()}storeSessionBackupPrivateKey(e,t){var r=this;return(0,i.A)((function*(){var n=(0,k.WG)(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(o.BackupDecryptionKey.fromBase64(n),t)}))()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return(0,i.A)((function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var n=o.BackupDecryptionKey.fromBase64(t);if(!ne(n,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(n,r.version)}))()}getActiveSessionBackupVersion(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.getActiveBackupVersion()}))()}getKeyBackupInfo(){var e=this;return(0,i.A)((function*(){return(yield e.backupManager.getServerBackupInfo())||null}))()}isKeyBackupTrusted(e){var t=this;return(0,i.A)((function*(){return yield t.backupManager.isKeyBackupTrusted(e)}))()}checkKeyBackupAndEnable(){var e=this;return(0,i.A)((function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)}))()}deleteKeyBackupVersion(e){var t=this;return(0,i.A)((function*(){yield t.backupManager.deleteKeyBackupVersion(e)}))()}resetKeyBackup(){var e=this;return(0,i.A)((function*(){var t=yield e.backupManager.setupKeyBackup((t=>e.signObject(t)));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()}))()}signObject(e){var t=this;return(0,i.A)((function*(){var r=new Map(Object.entries(e.signatures||{})),n=e.unsigned;delete e.signatures,delete e.unsigned;var i=r.get(t.userId)||{},o=u.stringify(e),s=yield t.olmMachine.sign(o),_=JSON.parse(s.asJSON());r.set(t.userId,ye(ye({},i),_[t.userId])),void 0!==n&&(e.unsigned=n),e.signatures=Object.fromEntries(r.entries())}))()}restoreKeyBackupWithPassphrase(e,t){var r=this;return(0,i.A)((function*(){var n=yield r.backupManager.getServerBackupInfo();if(null===n||void 0===n||!n.version)throw new Error("No backup info available");var i=yield(0,le.c)(n.auth_data,e);return yield r.storeSessionBackupPrivateKey(i,n.version),r.restoreKeyBackup(t)}))()}restoreKeyBackup(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:n,backupVersion:i}=r;if(!n||!i)throw new Error("No decryption key found in crypto store");var o=(0,k.y4)(n.toBase64()),s=yield t.backupManager.requestKeyBackupVersion(i);if(!s)throw new Error("Backup version to restore ".concat(i," not found on server"));var _=yield t.getBackupDecryptor(s,o);try{var c;return null===e||void 0===e||null===(c=e.progressCallback)||void 0===c||c.call(e,{stage:"fetch"}),yield t.backupManager.restoreKeyBackup(i,_,e)}finally{_.free()}}))()}isDehydrationSupported(){var e=this;return(0,i.A)((function*(){return yield e.dehydratedDeviceManager.isSupported()}))()}startDehydration(){var e=arguments,t=this;return(0,i.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})}))()}importSecretsBundle(e){var t=this;return(0,i.A)((function*(){var r=o.SecretsBundle.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)}))()}exportSecretsBundle(){var e=this;return(0,i.A)((function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r}))()}encryptToDeviceMessages(e,t,r){var n=this;return(0,i.A)((function*(){var s=new p.T(n.logger,"encryptToDeviceMessages"),_=new Set(t.map((e=>{var{userId:t}=e;return t})));yield n.keyClaimManager.ensureSessionsForUsers(s,Array.from(_).map((e=>new o.UserId(e))));var c={batch:[],eventType:w.Bx.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var t=(0,i.A)((function*(t){var{userId:i,deviceId:s}=t,_=yield n.olmMachine.getDevice(new o.UserId(i),new o.DeviceId(s));if(_){var a=JSON.parse(yield _.encryptToDeviceEvent(e,r));c.batch.push({deviceId:s,userId:i,payload:a})}else n.logger.warn("encryptToDeviceMessages: unknown device ".concat(i,":").concat(s))}));return function(e){return t.apply(this,arguments)}}())),c}))()}resetEncryption(e){var t=this;return(0,i.A)((function*(){t.logger.debug("resetEncryption: resetting encryption"),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.secretStorage.setDefaultKeyId(null),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")}))()}receiveSyncChanges(e){var t=this;return(0,i.A)((function*(){var{events:r,oneTimeKeysCounts:n=new Map,unusedFallbackKeys:s,devices:_=new o.DeviceLists}=e,c=yield(0,f.NQ)(p.v,"receiveSyncChanges",(0,i.A)((function*(){return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",_,n,s)})));return JSON.parse(c)}))()}preprocessToDeviceMessages(e){var t=this;return(0,i.A)((function*(){var r=yield t.receiveSyncChanges({events:e});for(var n of r)if(n.type===w.Bx.KeyVerificationRequest){var i=n.sender,o=n.content.transaction_id;o&&i&&t.onIncomingKeyVerificationRequest(i,o)}return r}))()}processKeyCounts(e,t){var r=this;return(0,i.A)((function*(){var n=e&&new Map(Object.entries(e)),i=t&&new Set(t);void 0===n&&void 0===i||(yield r.receiveSyncChanges({oneTimeKeysCounts:n,unusedFallbackKeys:i}))}))()}processDeviceLists(e){var t=this;return(0,i.A)((function*(){var r,n,i=new o.DeviceLists(null===(r=e.changed)||void 0===r?void 0:r.map((e=>new o.UserId(e))),null===(n=e.left)||void 0===n?void 0:n.map((e=>new o.UserId(e))));yield t.receiveSyncChanges({devices:i})}))()}onCryptoEvent(e,t){var r=this;return(0,i.A)((function*(){var n=t.getContent(),i=new o.RoomSettings;if("m.megolm.v1.aes-sha2"===n.algorithm){i.algorithm=o.EncryptionAlgorithm.MegolmV1AesSha2;try{i.sessionRotationPeriodMs=n.rotation_period_ms,i.sessionRotationPeriodMessages=n.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new o.RoomId(e.roomId),i)}catch(_){return void r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(_))}var s=r.roomEncryptors[e.roomId];s?s.onCryptoEvent(n):r.roomEncryptors[e.roomId]=new v(r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,n)}else r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(n.algorithm))}))()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",e)}))}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new o.UserId(e),t);r?this.emit(b.CryptoEvent.VerificationRequestReceived,new W(this.olmMachine,r,this.outgoingRequestProcessor,this._supportedVerificationMethods)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}onRoomMembership(e,t,r){var n=this.roomEncryptors[e.getRoomId()];n&&n.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return(0,i.A)((function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()}))()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(0!==r.length){this.logger.debug("Retrying decryption on events:",r.map((e=>"".concat(e.getId()))));var n=function(e){e.attemptDecryption(t,{isRetry:!0}).catch((r=>{t.logger.info("Still unable to decrypt event ".concat(e.getId()," after receiving key"))}))};for(var i of r)n(i)}}}onRoomKeysWithheld(e){var t=this;return(0,i.A)((function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var n=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(0===n.length)return;for(var i of(t.logger.debug("Retrying decryption on events:",n.map((e=>"".concat(e.getId())))),n))i.attemptDecryption(t,{isRetry:!0}).catch((e=>{}))}}))()}onUserIdentityUpdated(e){var t=this;return(0,i.A)((function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(b.CryptoEvent.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(b.CryptoEvent.KeysChanged,{}),yield t.checkKeyBackupAndEnable())}))()}onDevicesUpdated(e){var t=this;return(0,i.A)((function*(){t.emit(b.CryptoEvent.WillUpdateDevices,e,!1),t.emit(b.CryptoEvent.DevicesUpdated,e,!1)}))()}handleSecretReceived(e,t){var r=this;return(0,i.A)((function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),"m.megolm_backup.v1"===e&&(yield r.backupManager.handleBackupSecretReceived(t))}))()}checkSecrets(e){var t=this;return(0,i.A)((function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var n of r)if(yield t.handleSecretReceived(e,n))break;yield t.olmMachine.deleteSecretsFromInbox(e)}))()}onLiveEventFromSync(e){var t=this;return(0,i.A)((function*(){if(!e.isState()&&!e.getUnsigned().transaction_id){var r=function(){var r=(0,i.A)((function*(r){X(e)&&(yield t.onKeyVerificationEvent(r))}));return function(e){return r.apply(this,arguments)}}();if(e.isDecryptionFailure()||e.isEncrypted()){var n=3e5,o=setTimeout((()=>e.off(d.OQ.Decrypted,s)),n),s=(t,n)=>{n||(clearTimeout(o),e.off(d.OQ.Decrypted,s),r(t))};e.on(d.OQ.Decrypted,s)}else yield r(e)}}))()}onKeyVerificationEvent(e){var t=this;return(0,i.A)((function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new o.RoomId(r)),e.getType()===w.Bx.RoomMessage&&e.getContent().msgtype===w.Wr.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",e)}))}))()}getOwnIdentity(){var e=this;return(0,i.A)((function*(){return yield e.olmMachine.getIdentity(new o.UserId(e.userId))}))()}}class fe{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,(0,n.A)(this,"eventsPendingKey",new f.kG((()=>new f.kG((()=>new Set)))))}attemptEventDecryption(e,t){var r=this;return(0,i.A)((function*(){var n;switch(r.addEventToPendingList(e),t.kind){case b.DeviceIsolationModeKind.AllDevicesIsolationMode:n=o.TrustRequirement.Untrusted;break;case b.DeviceIsolationModeKind.OnlySignedDevicesIsolationMode:n=o.TrustRequirement.CrossSignedOrLegacy;break}try{var i=yield r.olmMachine.decryptRoomEvent(be(e),new o.RoomId(e.getRoomId()),new o.DecryptionSettings(n));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(i.event),claimedEd25519Key:i.senderClaimedEd25519Key,senderCurve25519Key:i.senderCurve25519Key,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain}}catch(s){if(!(s instanceof o.MegolmDecryptionError))throw new l.O(b.DecryptionFailureCode.UNKNOWN_ERROR,"Unknown error");r.onMegolmDecryptionError(e,s,yield r.perSessionBackupDownloader.getServerBackupInfo())}}))()}onMegolmDecryptionError(e,t,r){var n=e.getWireContent(),i={sender_key:n.sender_key,session_id:n.session_id};if(t.code===o.DecryptionErrorCode.MissingRoomKey||t.code===o.DecryptionErrorCode.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),n.session_id);var s=e.getMembershipAtEvent();if(s&&s!==g.O.Join&&s!==g.O.Invite)throw new l.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",i);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw null===r?new l.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",i):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new l.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",i):new l.O(b.DecryptionFailureCode.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",i)}if(t.maybe_withheld){var _="The sender has disabled encrypting to unverified devices."===t.maybe_withheld?b.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:b.DecryptionFailureCode.MEGOLM_KEY_WITHHELD;throw new l.O(_,t.maybe_withheld,i)}switch(t.code){case o.DecryptionErrorCode.MissingRoomKey:throw new l.O(b.DecryptionFailureCode.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",i);case o.DecryptionErrorCode.UnknownMessageIndex:throw new l.O(b.DecryptionFailureCode.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",i);case o.DecryptionErrorCode.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new l.O(b.DecryptionFailureCode.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case o.DecryptionErrorCode.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new l.O(b.DecryptionFailureCode.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case o.DecryptionErrorCode.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new l.O(b.DecryptionFailureCode.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new l.O(b.DecryptionFailureCode.UNKNOWN_ERROR,t.description,i)}}getEncryptionInfoForEvent(e){var t=this;return(0,i.A)((function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(null!==e.status)return{shieldColour:b.EventShieldColour.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(be(e),new o.RoomId(e.getRoomId()));return ve(t.logger,r)}))()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var n=r.get(t);return n?[...n]:[]}addEventToPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t),n=r.getOrCreate(e.getWireContent().session_id);n.add(e)}}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var n=r.get(e.getWireContent().session_id);n&&(n.delete(e),0===n.size&&(r.delete(e.getWireContent().session_id),0===r.size&&this.eventsPendingKey.delete(t)))}}}}function be(e){return JSON.stringify({event_id:e.getId(),type:e.getWireType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getWireContent(),origin_server_ts:e.getTs()})}function ve(e,t){if(void 0===t)return null;var r,n,i=t.shieldState(!1);switch(i.color){case o.ShieldColor.Grey:r=b.EventShieldColour.GREY;break;case o.ShieldColor.None:r=b.EventShieldColour.NONE;break;default:r=b.EventShieldColour.RED}switch(i.code){case void 0:case null:n=null;break;case o.ShieldStateCode.AuthenticityNotGuaranteed:n=b.EventShieldReason.AUTHENTICITY_NOT_GUARANTEED;break;case o.ShieldStateCode.UnknownDevice:n=b.EventShieldReason.UNKNOWN_DEVICE;break;case o.ShieldStateCode.UnsignedDevice:n=b.EventShieldReason.UNSIGNED_DEVICE;break;case o.ShieldStateCode.UnverifiedIdentity:n=b.EventShieldReason.UNVERIFIED_IDENTITY;break;case o.ShieldStateCode.SentInClear:n=b.EventShieldReason.SENT_IN_CLEAR;break;case o.ShieldStateCode.VerificationViolation:n=b.EventShieldReason.VERIFICATION_VIOLATION;break}return{shieldColour:r,shieldReason:n}}var me=r(5982),ke=r(8968),Se=r(4519);function Re(e){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,i.A)((function*(e){var t,{logger:r,legacyStore:n}=e;if(yield a(),new o.Tracing(o.LoggerLevel.Debug).turnOn(),yield n.containsData()){yield n.startup();var i=null;if(yield n.doTxn("readonly",[ke.y.STORE_ACCOUNT],(e=>{n.getAccount(e,(e=>{i=e}))})),i){var s=yield n.getMigrationState();if(!(s>=me.Il.MEGOLM_SESSIONS_MIGRATED)){var _=yield Ee(r,n),c=yield Oe(r,n),u=1+_+c;r.info("Migrating data from legacy crypto store. ".concat(_," olm sessions and ").concat(c," megolm sessions to migrate."));var g=0;l(0);var d=(new TextEncoder).encode(e.legacyPickleKey);s===me.Il.NOT_STARTED&&(r.info("Migrating data from legacy crypto store. Step 1: base data"),yield Ke(e.http,e.userId,e.deviceId,n,d,e.storeHandle,r),s=me.Il.INITIAL_DATA_MIGRATED,yield n.setMigrationState(s)),l(1),s===me.Il.INITIAL_DATA_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(_," sessions to migrate).")),yield qe(r,n,d,e.storeHandle,l),s=me.Il.OLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),s===me.Il.OLM_SESSIONS_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(c," sessions to migrate).")),yield Be(r,n,d,e.storeHandle,l),s=me.Il.MEGOLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),null===(t=e.legacyMigrationProgressListener)||void 0===t||t.call(e,-1,-1),r.info("Migration from legacy crypto store complete")}}else r.debug("Legacy crypto store is not set up (no account found). Not migrating.")}function l(t){var r;g+=t,null===(r=e.legacyMigrationProgressListener)||void 0===r||r.call(e,g,u)}})),Ie.apply(this,arguments)}function Ke(e,t,r,n,i,o,s){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,i.A)((function*(e,t,r,n,i,s,_){var c=new o.BaseMigrationData;c.userId=new o.UserId(t),c.deviceId=new o.DeviceId(r),yield n.doTxn("readonly",[ke.y.STORE_ACCOUNT],(e=>n.getAccount(e,(e=>{c.pickledAccount=null!==e&&void 0!==e?e:""}))));var a=yield Te(n,i,"m.megolm_backup.v1");if(a){var u=!1,g=null;while(!u)try{g=yield te(e),u=!0}catch(w){_.info("Failed to get backup version during migration, retrying in 2 seconds",w),yield(0,f.yy)(2e3)}if(g&&"m.megolm_backup.v1.curve25519-aes-sha2"==g.algorithm)try{var d,l=o.BackupDecryptionKey.fromBase64(a),p=null===(d=g.auth_data)||void 0===d?void 0:d.public_key,y=l.megolmV1PublicKey.publicKeyBase64==p;y?(c.backupVersion=g.version,c.backupRecoveryKey=a):_.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(l.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(p))}catch(w){_.warn("Failed to check if the backup key to migrate matches the active backup version",w)}}c.privateCrossSigningMasterKey=yield Te(n,i,"master"),c.privateCrossSigningSelfSigningKey=yield Te(n,i,"self_signing"),c.privateCrossSigningUserSigningKey=yield Te(n,i,"user_signing"),yield o.Migration.migrateBaseData(c,i,s)})),Ce.apply(this,arguments)}function Ee(e,t){return De.apply(this,arguments)}function De(){return De=(0,i.A)((function*(e,t){var r;return e.debug("Counting olm sessions to be migrated"),yield t.doTxn("readonly",[ke.y.STORE_SESSIONS],(e=>t.countEndToEndSessions(e,(e=>r=e)))),r})),De.apply(this,arguments)}function Oe(e,t){return Me.apply(this,arguments)}function Me(){return Me=(0,i.A)((function*(e,t){return e.debug("Counting megolm sessions to be migrated"),yield t.countEndToEndInboundGroupSessions()})),Me.apply(this,arguments)}function qe(e,t,r,n,i){return Ae.apply(this,arguments)}function Ae(){return Ae=(0,i.A)((function*(e,t,r,n,i){while(1){var s=yield t.getEndToEndSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," olm sessions"));var _=[];for(var c of s){var a=new o.PickledSession;a.senderKey=c.deviceKey,a.pickle=c.session,a.lastUseTime=a.creationTime=new Date(c.lastReceivedMessageTs),_.push(a)}yield o.Migration.migrateOlmSessions(_,r,n),yield t.deleteEndToEndSessionsBatch(s),i(s.length)}})),Ae.apply(this,arguments)}function Be(e,t,r,n,i){return Ve.apply(this,arguments)}function Ve(){return Ve=(0,i.A)((function*(e,t,r,n,i){while(1){var s=yield t.getEndToEndInboundGroupSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," megolm sessions"));var _=[];for(var c of s){var a,u=c.sessionData,g=new o.PickledInboundGroupSession;g.pickle=u.session,g.roomId=new o.RoomId(u.room_id),g.senderKey=c.senderKey,g.senderSigningKey=null===(a=u.keysClaimed)||void 0===a?void 0:a["ed25519"],g.backedUp=!c.needsBackup,g.imported=!0===u.untrusted,_.push(g)}yield o.Migration.migrateMegolmSessions(_,r,n),yield t.deleteEndToEndInboundGroupSessionsBatch(s),i(s.length)}})),Ve.apply(this,arguments)}function Ue(e){return Fe.apply(this,arguments)}function Fe(){return Fe=(0,i.A)((function*(e){var{logger:t,legacyStore:r,olmMachine:n}=e;if(yield r.containsData()){var i=yield r.getMigrationState();if(!(i>=me.Il.ROOM_SETTINGS_MIGRATED)){var s={};for(var[_,c]of(yield r.doTxn("readwrite",[ke.y.STORE_ROOMS],(e=>{r.getEndToEndRooms(e,(e=>{s=e}))})),t.debug("Migrating ".concat(Object.keys(s).length," sets of room settings")),Object.entries(s)))try{var a=new o.RoomSettings;if("m.megolm.v1.aes-sha2"!==c.algorithm){t.warn("Room ".concat(_,": ignoring room with invalid algorithm ").concat(c.algorithm));continue}a.algorithm=o.EncryptionAlgorithm.MegolmV1AesSha2,a.sessionRotationPeriodMs=c.rotation_period_ms,a.sessionRotationPeriodMessages=c.rotation_period_msgs,yield n.setRoomSettings(new o.RoomId(_),a)}catch(u){t.warn("Room ".concat(_,": ignoring settings ").concat(JSON.stringify(c)," which caused error ").concat(u))}t.debug("Completed room settings migration"),yield r.setMigrationState(me.Il.ROOM_SETTINGS_MIGRATED)}}})),Fe.apply(this,arguments)}function Te(e,t,r){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,i.A)((function*(e,t,r){var n=yield new Promise((t=>{e.doTxn("readonly",[ke.y.STORE_ACCOUNT],(n=>{e.getSecretStorePrivateKey(n,t,r)}))}));return n&&n.ciphertext&&n.iv&&n.mac?yield(0,Se.A)(n,t,r):n instanceof Uint8Array?(0,k.WG)(n):void 0})),Pe.apply(this,arguments)}function Ne(e){return xe.apply(this,arguments)}function xe(){return xe=(0,i.A)((function*(e){var{legacyCryptoStore:t,rustCrypto:r,logger:n}=e,i=yield r.getOwnIdentity();if(i&&!i.isVerified()){var o=yield ze(t);if(o){var s=JSON.parse(i.masterKey);if(s.keys&&0!==Object.keys(s.keys).length){var _=Object.values(s.keys)[0];_&&_==o&&(n.info("Post Migration: Migrating legacy trusted MSK: ".concat(o," to locally verified.")),yield i.verify())}else n.error("Post Migration | Unexpected error: no master key in the rust session.")}}})),xe.apply(this,arguments)}function ze(e){return je.apply(this,arguments)}function je(){return je=(0,i.A)((function*(e){var t=null;return yield e.doTxn("readonly","account",(r=>{e.getCrossSigningKeys(r,(e=>{var r=null===e||void 0===e?void 0:e.master;r&&0!=Object.keys(r.keys).length&&(t=Object.values(r.keys)[0])}))})),t})),je.apply(this,arguments)}function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function We(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ge(e){return Qe.apply(this,arguments)}function Qe(){return Qe=(0,i.A)((function*(e){var t,{logger:r}=e;r.debug("Initialising Rust crypto-sdk WASM artifact"),yield a(),new o.Tracing(o.LoggerLevel.Debug).turnOn(),r.debug("Opening Rust CryptoStore"),t=e.storePrefix?e.storeKey?yield o.StoreHandle.openWithKey(e.storePrefix,e.storeKey):yield o.StoreHandle.open(e.storePrefix,e.storePassphrase):yield o.StoreHandle.open(),e.legacyCryptoStore&&(yield Re(We({legacyStore:e.legacyCryptoStore,storeHandle:t},e)));var n=yield Je(r,e.http,e.userId,e.deviceId,e.secretStorage,e.cryptoCallbacks,t,e.legacyCryptoStore);return t.free(),r.debug("Completed rust crypto-sdk setup"),n})),Qe.apply(this,arguments)}function Je(e,t,r,n,i,o,s,_){return He.apply(this,arguments)}function He(){return He=(0,i.A)((function*(e,t,r,n,i,s,_,c){e.debug("Init OlmMachine");var a=yield o.OlmMachine.initFromStore(new o.UserId(r),new o.DeviceId(n),_);c&&(yield Ue({logger:e,legacyStore:c,olmMachine:a})),a.roomKeyRequestsEnabled=!1;var u=new he(e,a,t,r,n,i,s);if(yield a.registerRoomKeyUpdatedCallback((e=>u.onRoomKeysUpdated(e))),yield a.registerRoomKeysWithheldCallback((e=>u.onRoomKeysWithheld(e))),yield a.registerUserIdentityUpdatedCallback((e=>u.onUserIdentityUpdated(e))),yield a.registerDevicesUpdatedCallback((e=>u.onDevicesUpdated(e))),u.checkSecrets("m.megolm_backup.v1"),yield a.registerReceiveSecretCallback(((e,t)=>u.checkSecrets(e))),yield a.outgoingRequests(),c&&(yield c.containsData())){var g=yield c.getMigrationState();if(g<me.Il.INITIAL_OWN_KEY_QUERY_DONE){e.debug("Performing initial key query after migration");var d=!1;while(!d)try{yield u.userHasCrossSigningKeys(r),d=!0}catch(l){e.error("Failed to check for cross-signing keys after migration, retrying",l)}yield Ne({legacyCryptoStore:c,rustCrypto:u,logger:e}),yield c.setMigrationState(me.Il.INITIAL_OWN_KEY_QUERY_DONE)}}return u})),He.apply(this,arguments)}},9627:function(e,t,r){e.exports=r.p+"cf0d92e46c1307f6.wasm"}}]);
//# sourceMappingURL=904.0405ec05.js.map